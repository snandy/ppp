/**
*
*  Copyright 2007 Sohu.com Inc. All rights reserved.
*  搜狐公司
*  @author jadyyang@sohu.com
*  date: 2008-04-23
**/
var Rss=Class.create();Object.extend(Rss.prototype,{initialize:function(url){this.url=url;this.entries=null;this.info=null;},domain:'http://reader.mail.sohu.com/blogwidget/',infoUrl:'get_feedinfo.json',entryUrl:'get_entry.json',requestInfo:function(options,noCache){this.infoOptions=options;this.requestInfoData(noCache);},requestInfoData:function(noCache){if(!noCache&&this.info)this.gotInfo({widget_data:this.info});else{var vn='rss_info_'+Time.now();var url=this.domain+this.infoUrl+'?feed_link='+encodeURIComponent(this.url)+'&vn='+vn;new Groj(url,{variable:vn,charset:'UTF-8',onSuccess:this.gotInfo.bind(this),onFailure:this.notGotInfo.bind(this)});}},gotInfo:function(data){if(data&&data.widget_data&&data.widget_data.error_code==0){this.info=data.widget_data.feed_info;if(this.infoOptions.onSuccess)this.infoOptions.onSuccess(this.info);}else{this.info=(data&&data.widget_data)?data.widget_data:null;if(this.infoOptions.onFailure)this.infoOptions.onFailure({description:'取不到feed信息'});}},notGotInfo:function(){this.info=null;if(this.infoOptions.onFailure)this.infoOptions.onFailure({description:'取不到feed信息'});},requestEntries:function(options){this.entryOptions=Object.extend({size:10,start:0,mode:'normal'},options);this.requestEntriesData();},requestEntriesData:function(){var vn='rss_entries_'+Time.now();var url=this.domain+this.entryUrl+'?feed_link='+encodeURIComponent(this.url)+'&vn='+vn+'&mode='+this.entryOptions.mode+'&limit='+this.entryOptions.size;new Groj(url,{variable:vn,charset:'UTF-8',onSuccess:this.gotEntries.bind(this),onFailure:this.notGotEntries.bind(this)});},gotEntries:function(data){if(data&&data.widget_data&&data.widget_data.error_code==0){this.entries=data.widget_data.entry_info;if(this.entryOptions.onSuccess)this.entryOptions.onSuccess(this.entries);}else{this.entries=(data&&data.widget_data)?data.widget_data:null;if(this.entryOptions.onFailure)this.entryOptions.onFailure({description:'取不到feed信息'});}},notGotEntries:function(){this.entries=null;if(this.entryOptions.onFailure)this.entryOptions.onFailure({description:'取不到feed信息'});}});Rss.getInfo=function(url,options){var r=new Rss(url);r.requestInfo(options);return this;}
Rss.getEntries=function(url,options){var r=new Rss(url);r.requestEntries(options);return this;}