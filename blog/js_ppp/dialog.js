/**
 * Author: @snandy
 * Date: 2012-8-16 10:43:21
 */
(function(a,b,c){function s(){var b="http://i.sohu.com/a/app/friend/friend/add.do"+q,c="http://i.sohu.com/a/app/friend/addattentions?cb=?",d=e.el.find(".pho-recommend li").map(function(){if(a("i",this).css("display")!="none")return this.getAttribute("data-xpt")}).get().join(",");a.getJSON(b,{xpt:_upt,from_type:"blog_rec_flow"},function(a){e.success(a.code)}),d&&a.getJSON(c,{userid:d,from_type:"blog_recommend"})}function t(){if(!a.ppDialog)return;a.ppDialog({appId:"1001",regRedirectUrl:location.href,title:"想要查看更多精彩内容，马上登录吧！",onLogin:function(a){if(isOwnBlog()){e.close();return}s(),n=!0}})}function u(){function b(){new a.iCard({bindElement:e.el,params:{product:"def"}})}e.open(),d(0),n=!0,setTimeout(b,1e3)}function v(){if(n||m){o.unbind("scroll",v);return}var b=p.scrollTop();g-b+125<k&&(isPPLogin()?isOwnBlog()||(a.getJSON(h,{xpts:_upt},function(a){a.data.friendList.length||u()}),m=!0):u())}var d,e,f,g,h,i,j,k,l,m=!1,n=!1,o=a(b),p=a(c),q="?callback=?",r=a.browser.version=="6.0";f=a("#entrycommentlist h3").first(),g=f.offset().top,l=function(){return{w:o.width(),h:o.height()}},k=l().h,j="http://i.sohu.com/a/blog/home/follow.htm"+q,h="http://i.sohu.com/a/app/friend/get/friend/relation.do?cb=?",i=typeof showurl!="undefined"?showurl:"http://i.sohu.com",d=function(b){a.getJSON(j,{status:b})},e=function(){function k(){var a=l();e.moveCenter(),g.width(a.w).height(a.h)}function m(){e.moveCenter()}function n(){e.close(),d(2)}function p(){e.close(),d(3)}var b=l(),f=a('<div class="poping-blog-follow"><div class="poping-blog-follow-wrapper"><div class="bf-header"><a href="javascript://" class="btn-close"></a><p>一亿人当中你遇见了我...</p></div><div class="bf-body"><div class="img"><a target="_blank" href="'+i+'"></a>'+"</div>"+'<div class="txt"></div>'+"</div>"+'<div class="bf-recommend">'+'<h4>博主推荐的人：<label><input type="checkbox">同时跟随博主推荐的所有人</label></h4>'+'<div class="pho-recommend"><ul></ul></div>'+"</div>"+'<div class="bf-btn">'+'<a href="javascript://;" class="btn-enter btn-enter-hover"></a>'+"</div>"+"</div></div>"),g=a('<div class="poping-mask"></div>').width(b.w).height(b.h),h=function(){var b=typeof hidimg!="undefined"?hidimg:"",c='<img src="'+b+'" data-card="true" data-card-action="xpt='+_upt+'">',d="http://i.sohu.com/a/app/friend/recommend/add.do?cb=?",e="http://i.sohu.com/a/app/friend/recommend/list/"+_upt+"/?cb=?";f.find(".img a").html(c),f.find(".txt").html('<p class="tt">嗨，我是 <a href="'+i+'" target="_blank" data-card="true" data-card-action="xpt='+_upt+'">'+(nick||"")+"</a>"+"</p>"+'<p class="con">如果想第一时间阅读我的最新博文，那就快来跟随我吧！</p>'),a.getJSON(e,function(b){if(b.code!=0||b.data.viewRecommends.length==0)return;var c=f.find(".bf-recommend"),d=c.find("ul");a(b.data.viewRecommends).each(function(a,b){var c='<img src="'+b.icon+'" data-card="true" data-card-action="xpt='+b.xpt+'">';d.append('<li data-xpt="'+b.xpt+'" title="'+b.nick+'">'+'<i class="icon-select"></i><a href="javascript://;">'+c+"</a>"+"</li>")}),c.delegate("li","click",function(){a("i",this).toggle()}).delegate("input","click",function(){this.checked?c.find("i").show():c.find("i").hide()}).show(),c.find("input").click(),c.find("i").show()})},j=function(){f.delegate("div.img a, p.tt a","click",function(){d(5)}).delegate("a.close, a.btn-geren","click",function(){e.close(),a(this).hasClass("btn-close")?d(2):a(this).hasClass("close")?d(3):a(this).hasClass("btn-geren")&&d(4)}).delegate(".btn-enter","click",function(a){a.preventDefault(),d(7);var b=f.find(".btn-close");b.unbind("click",n),b.click(p),isPPLogin()?s():t()}),f.find(".btn-close").click(n)};return{el:f,open:function(){h(),j(),c.body.appendChild(g[0]),c.body.appendChild(f[0]),this.moveCenter(),r&&o.scroll(m),o.resize(k)},close:function(){c.body.removeChild(g[0]),c.body.removeChild(f[0]),r&&o.unbind("scroll",m),o.unbind("resize",k)},success:function(a){var b="";a==1&&(b="跟随成功",d(1)),a==-2&&(b="已跟随过",d(6)),f.find(".bf-recommend").hide(),f.find(".txt").html('<p class="success">'+b+"！你可以在个人中心里看到我的各种新鲜事了。</p>"),f.find(".bf-btn").html('<a target="_blank" href="http://i.sohu.com/blog/home/entry/index.htm" class="btn-geren"></a><a href="javascript://" class="close">我知道了</a>')},moveCenter:function(){var a=l(),b=f[0],d=(a.w-50)/2-(b.clientWidth-50)/2,e=(a.h-50)/2-(b.clientHeight-50)/2;r&&(b.style.position="absolute",e=(a.h-50)/2-(b.clientHeight-50)/2+c.documentElement.scrollTop),b.style.left=d+"px",b.style.top=e+"px"}}}(),o.scroll(v),jQuery.followDlg=e})(jQuery,window,document)