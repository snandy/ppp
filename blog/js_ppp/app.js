function registerWidget(w){App.Widgets[w]=eval(w)}function loginPath(){return"http://blog.sohu.com/login/logon.do?bru="+encodeURIComponent(location.href)}var App={version:"0.2",status:isMyBlog()?getUserType()==3?3:2:1,theme:typeof _theme!="undefined"?_theme:"default",lang:typeof lang!="undefined"?lang:"zh",Actions:Object.extend({imgPath:"http://js3.pp.sohu.com.cn/ppp/blog/styles_ppp/images/",icoShortPath:"custom/icons/",themePath:"http://js1.pp.sohu.com.cn/ppp/blog/themes_ppp/",jsPath:"http://js2.pp.sohu.com.cn/ppp/blog/js_ppp/",widgetLibPath:"http://js4.pp.sohu.com.cn/ppp/blog/widgets/",customTheme:"/manage/style.do",userData:"/action/",newMod:"/manage/module.do",delMod:"/manage/module.do",editMod:"/manage/module.do",newPage:"/manage/page.do",delPage:"/manage/page.do",editPage:"/manage/page.do",editUserStyle:"/manage/module.do",theme:"/manage/theme.do",themeGW:"/manage/theme.do",linkMng:"/manage/link.do",greenWay:"http://act.blog.sohu.com/service/list_code.jsp",proxyURL:"/hp"},typeof Actions!="undefined"?Actions:{}),noCache:typeof noCache!="undefined"?noCache:!1,cacheTime:typeof defaultCacheTime!="undefined"?defaultCacheTime:30,maxWidgetLoadTime:typeof maxWidgetLoadTime!="undefined"?maxWidgetLoadTime:1e4,colStyleLib:Object.extend({"25:25:25:25":"custom/colStyles/25_25_25_25.gif","25:50:25":"custom/colStyles/25_50_25.gif","25:25:50":"custom/colStyles/25_25_50.gif","50:25:25":"custom/colStyles/50_25_25.gif","50:50":"custom/colStyles/50_50.gif","25:75":"custom/colStyles/25_75.gif","75:25":"custom/colStyles/75_25.gif"},typeof colStyleLib!="undefined"?colStyleLib:{}),icoLib:Object.extend(["none.gif","anchor.gif","attach.gif","basket.gif","bomb.gif","book.gif","book_addresses.gif","book_open.gif","brick.gif","briefcase.gif","bug.gif","cake.gif","calendar_view_day.gif","calendar_view_month.gif","camera.gif","car.gif","cd.gif","chart_bar.gif","chart_curve.gif","chart_organisation.gif","chart_pie.gif","clock.gif","clock_red.gif","cog.gif","coins.gif","color_swatch.gif","comment.gif","computer.gif","connect.gif","creditcards.gif","door.gif","door_open.gif","drink.gif","drink_empty.gif","email.gif","email_open.gif","email_open_image.gif","emoticon_evilgrin.gif","emoticon_grin.gif","emoticon_happy.gif","emoticon_smile.gif","emoticon_surprised.gif","emoticon_tongue.gif","emoticon_unhappy.gif","emoticon_waii.gif","emoticon_wink.gif","exclamation.gif","eye.gif","feed.gif","flag_blue.gif","flag_green.gif","flag_orange.gif","flag_pink.gif","flag_purple.gif","flag_red.gif","flag_yellow.gif","folder.gif","heart.gif","house.gif","image.gif","information.gif","ipod.gif","keyboard.gif","layout.gif","lightbulb.gif","lightbulb_off.gif","lock.gif","lock_open.gif","lorry.gif","lorry_flatbed.gif","magnifier.gif","money.gif","money_dollar.gif","money_euro.gif","money_pound.gif","money_yen.gif","monitor.gif","mouse.gif","music.gif","new.gif","note.gif","page.gif","page_copy.gif","page_white.gif","page_white_acrobat.gif","page_white_code.gif","page_white_compressed.gif","page_white_excel.gif","page_white_flash.gif","page_white_php.gif","page_white_picture.gif","page_white_powerpoint.gif","page_white_text.gif","page_white_word.gif","page_white_world.gif","palette.gif","paste_plain.gif","pencil.gif","phone.gif","photo.gif","picture.gif","printer.gif","printer_empty.gif","rainbow.gif","rosette.gif","server.gif","shield.gif","sport_8ball.gif","sport_basketball.gif","sport_football.gif","sport_golf.gif","sport_raquet.gif","sport_shuttlecock.gif","sport_soccer.gif","sport_tennis.gif","star.gif","stop.gif","tag_blue.gif","tag_green.gif","tag_orange.gif","tag_pink.gif","tag_purple.gif","tag_red.gif","tag_yellow.gif","telephone.gif","television.gif","thumb_down.gif","thumb_up.gif","trash.gif","tux.gif","user.gif","user_female.gif","user_gray.gif","user_green.gif","user_orange.gif","user_red.gif","user_suit.gif","vcard.gif","weather_clouds.gif","weather_cloudy.gif","weather_lightning.gif","weather_rain.gif","weather_snow.gif","weather_sun.gif","world.gif","zoom.gif","chinaren.gif","olympic.gif"],typeof icoLib!="undefined"?icoLib:[]),highlightStyle:Object.extend({backgroundColor:"white",border:"1px solid #ccc",padding:"0"},typeof highlightStyle!="undefined"?highlightStyle:{}),unHighlightStyle:Object.extend({backgroundColor:"transparent",border:"none",padding:"1px"},typeof unHighlightStyle!="undefined"?unHighlightStyle:{}),colId_prefix:typeof colId_prefix!="undefined"?colId_prefix:"col_",pageHash_prefix:typeof pageHash_prefix!="undefined"?pageHash_prefix:"tp_",defaultColStyle:"33:33:33",createOnlyFirstPageMod:typeof createOnlyFirstPageMod!="undefined"?createOnlyFirstPageMod:!0,maxPageTabCount:typeof maxPageTabCount!="undefined"?maxPageTabCount:5,maxPerPageModCount:typeof maxPerPageModCount!="undefined"?maxPerPageModCount:20,showNewWidgtTip:typeof showNewWidgtTip!="undefined"?showNewWidgtTip:!1,showNewThemeTip:typeof showNewThemeTip!="undefined"?showNewThemeTip:!1,cancelBubble:function(a){Event.stop(a)}};App.Permit={resize:App.status==2,editModule:App.status==2,sortable:App.status==2,editTheme:App.status==2,editHead:App.status==2,editPageTab:App.status==2,ableViewPvtPageTab:App.status==2||App.status==3,ableToy:getUrlParam("t"+"o"+"y")=="true",able3rdDev:getUrlParam("3"+"r"+"dD"+"e"+"v")=="true",ableDemo:getUrlParam("p"+"p"+"pDe"+"vel"+"ope"+"r")=="true",ableLog:getUrlParam("l"+"o"+"g")=="true"},App.Lib={lib:Object.extend({Lang:App.Actions.jsPath+"lang_"+App.lang+".js"},typeof lib!="undefined"?lib:{}),load:function(){$H(this.lib).each(function(a){document.write('<script type="text/javascript" charset="utf-8" src="'+a.value+'"></scr'+"ipt>")})}},App.Lib.load(),App.WidgetLib={gallery:Object.extend([{key:"other",title:""}],typeof widgetGallery!="undefined"?widgetGallery:[]),getGallery:function(a){return this.gallery.find(function(b){return b&&b.key&&b.key==a})},lib:Object.extend([],typeof widgetLib!="undefined"?widgetLib:[]),getWidget:function(a){return this.lib.find(function(b){return b&&b.type&&b.type==a})},analyseAll:function(){var a=[];$A(this.lib).each(function(b){var c=this.getAnalysedWidget(b);c&&(a.push(c),c.isNew&&this.getGallery(c.gal)&&!this.getGallery(c.gal).hasNew&&(this.getGallery(c.gal).hasNew=!0,this.hasNew||(this.hasNew=!0)))}.bind(this)),this.lib=a},getAnalysedWidget:function(a){var b=Object.extend({title:"No Title",desc:"no description.",ico:App.Actions.imgPath+"ico_widget.gif",author:"Todd Lee",site:"http://www.todd-lee.com",pubDate:"Sun, 16 May 1982 11:30:00 GMT",type:"",path:"",js:[],css:[],only:!1,sys:!1,ableDel:!0,toy:!1,dev:!1,demo:!1,"private":!1,gal:"other"},a||{});!App.showNewWidgtTip&&b.isNew&&(b.isNew=null);if(!b.type)return alert("Error: widget type is undefined."),null;if(!b.path)return alert("Error: path of widget ["+b.type+"] is undefined."),null;var c=b.path;if(b.ico){var d=b.ico.trim();d&&d.indexOf("http://")!==0&&d.indexOf("/")!==0&&(d=c+(d||"")),b.ico=d}return $A(b.js).each(function(a,d){a.indexOf("http://")!==0&&a.indexOf("/")!==0&&(b.js[d]=c+a)}),$A(b.css).each(function(a,d){a.indexOf("http://")!==0&&a.indexOf("/")!==0&&(b.css[d]=c+a)}),b}},App.WidgetLib.analyseAll(),App.PageLib={lib:Object.extend([],typeof pageLib!="undefined"?pageLib:[]),getPage:function(a){return this.lib.find(function(b){return b&&b.type&&b.type==a})},analyseAll:function(){var a=[];$A(this.lib).each(function(b){var c=this.getAnalysedPage(b);c&&a.push(c)}.bind(this)),this.lib=a},getAnalysedPage:function(a){var b=Object.extend({title:"",desc:"",ico:0,author:"Todd Lee",site:"http://www.todd-lee.com",pubDate:"Sun, 16 May 1982 11:30:00 GMT",type:"",hash:"",colStyle:App.defaultColStyle,widgets:[],permit:0,only:!1,ableDel:!0,ableSetOpt:!0,ableSetTit:!0,ableSetCol:!0,ableSetIco:!0,ableSetPer:!0,toy:!1,dev:!1,demo:!1},a||{});return b.type?b.hash?b:(alert("Error: page hash is undefined."),null):(alert("Error: page type is undefined."),null)}},App.PageLib.analyseAll(),App.ThemeLib={group:Object.extend([{key:"sys",title:""}],typeof themeGroup!="undefined"?themeGroup:[]),getGroup:function(a){return this.group.find(function(b){return b&&b.key&&b.key==a})},lib:Object.extend([],typeof themeLib!="undefined"?themeLib:[]),getTheme:function(a){return this.lib.find(function(b){return b&&b.id&&b.id==a})},analyseAll:function(){var a=[];$A(this.lib).each(function(b){var c=this.getAnalysedTheme(b);c&&(a.push(c),c.isNew&&this.getGroup(c.grp)&&!this.getGroup(c.grp).hasNew&&(this.getGroup(c.grp).hasNew=!0,this.hasNew||(this.hasNew=!0)))}.bind(this)),this.lib=a},getAnalysedTheme:function(a){var b=Object.extend({id:"",grp:"sys",smp:"sample.jpg",path:"",code:"",name:""},a||{});return!App.showNewThemeTip&&b.isNew&&(b.isNew=null),b.id?b:(alert("Error: theme id is undefined."),null)},add:function(a){if(this.getTheme(a.id))return;this.lib.push(this.getAnalysedTheme(a))}},App.ThemeLib.analyseAll(),App.CusThemeLib={headerBgi:{lib:Object.extend([],typeof cusThemeHeaderBgi!="undefined"?cusThemeHeaderBgi:[]),getImg:function(a){return this.lib.find(function(b){return b&&b.src&&b.src==a})},analyseAll:function(){var a=[];$A(this.lib).each(function(b){var c=this.getAnalysedImg(b);c&&a.push(c)}.bind(this)),this.lib=a},getAnalysedImg:function(a){var b=Object.extend({src:"",smp:"",tiled:"",align:"",height:""},a||{});return b.src?b:(alert("Error: header bgi url is undefined."),null)}},bodyBgi:{lib:Object.extend([],typeof cusThemeBodyBgi!="undefined"?cusThemeBodyBgi:[]),getImg:function(a){return this.lib.find(function(b){return b&&b.src&&b.src==a})},analyseAll:function(){var a=[];$A(this.lib).each(function(b){var c=this.getAnalysedImg(b);c&&a.push(c)}.bind(this)),this.lib=a},getAnalysedImg:function(a){var b=Object.extend({src:"",smp:"",tiled:"",align:""},a||{});return b.src?b:(alert("Error: header bgi url is undefined."),null)}}},App.CusThemeLib.headerBgi.analyseAll(),App.CusThemeLib.bodyBgi.analyseAll(),App.ImpBase=function(){},App.ImpBase.prototype={setOptions:function(a){this.options=Object.extend({parameters:"",onFailure:this.reportError.bind(this),method:"get"},a||{}),App.noCache&&(this.options.parameters=this.options.parameters?this.options.parameters+"&c="+timeStamp():"c="+timeStamp())},reportError:function(a){var b=App.Lang.error+": "+a.status+" "+(typeof a.statusText!="undefined"?a.statusText:"")+"\n\n";return a.status=="404"?(b+=App.Lang.fileNotFound,b+=" ( "+this.url+" )\n"):a.status=="500"?(b+=App.Lang.serverError,b+=" ( "+this.url+" )\n"):a.status=="403"?(b+=App.Lang.noPermit,b+=" ( "+this.url+" )\n"):a.status=="12007"?b+=App.Lang.notConneted:a.status=="12029"?(b+=App.Lang.cannotGetConnetion,b+=" ( "+this.url+" )\n"):(b+=App.Lang.unknownError,b+=" ( "+this.url+" )\n"),a.status=="500"&&(b+=App.Lang.contactAdmin+"\n"),LoadBar.hide(),alert(b),!1},showError:function(a){var b={type:"alert",title:App.Lang.info,content:a,width:"600"},c=new PopWin(b)}},App.ImpFile=Class.create(),App.ImpFile.prototype=Object.extend(new App.ImpBase,{initialize:function(a,b){a=a.trim();var c;this.setOptions(b),isLocalFile(a)?c=a:(c=App.Actions.proxyURL,this.options.parameters+=(this.options.parameters.length>0?"&":"")+"url="+encodeURIComponent(a)),this.options.nocache&&(this.options.parameters+=(this.options.parameters.length>0?"&":"")+"nocache="+timeStamp()),this.url=c;var d=new Ajax.Request(this.url,this.options)}}),App.EditableText=Class.create(),App.EditableText.prototype={initialize:function(a,b){this.obj=a,this.options=Object.extend({able:!0,type:"text",defaultValue:"",showBtn:!1,overStyle:App.highlightStyle,outStyle:App.unHighlightStyle,maxSize:9999,maxLenght:9999,filter:function(a){return a}},b||{}),this.type=this.options.type,this.setOut(),this.buildText(),this.options.able&&(Event.observe(this.obj,"mouseover",this.setOver.bindAsEventListener(this)),Event.observe(this.obj,"mouseout",this.setOut.bindAsEventListener(this)),this.eventCancelBubble=App.cancelBubble.bindAsEventListener(this),Event.observe(this.obj,"click",this.eventCancelBubble),Event.observe(this.obj,"click",this.setToEditMode.bindAsEventListener(this)))},buildText:function(){this.data=this.obj.innerHTML.convertHTMLToText().convertTextToHTML()||this.options.defaultValue;var a="";this.type=="text"?(a+="<span>"+this.options.filter(this.data)+"</span>",a+='<span style="display:none"><input type="text" maxlength="'+this.options.maxLenght+'" /></span>',this.obj.innerHTML=a):this.type=="area"&&(a+="<div>"+this.options.filter(this.data)+"</div>",a+='<div style="display:none">',a+='<textarea style="overflow:auto;" maxlength="'+this.options.maxLenght+'"></textarea>',a+="</div>",this.obj.innerHTML=a),this.text=this.obj.firstChild,this.edit=this.text.nextSibling,this.inputElm=this.edit.firstChild},setOver:function(){if(this.editing)return!1;Element.setStyle(this.obj,this.options.overStyle),this.obj.style.cursor="text"},setOut:function(){if(this.editing)return!1;Element.setStyle(this.obj,this.options.outStyle),this.obj.style.cursor="default"},setToEditMode:function(){if(this.editing)return!1;this.editing=!0,this.setOver(),this.initForm()},initForm:function(){if(this.options.showBtn){var a="";a+='<span><input type="button" value="'+App.Lang.save+'" />',a+='<a href="javascript:void(0)">'+App.Lang.cancel+"</a></span>";var b=new Insertion.After(this.obj,a),c=this.obj.nextSibling,d=c.firstChild,e=c.lastChild;Event.observe(d,"click",this.finish.bindAsEventListener(this)),Event.observe(e,"click",this.cancel.bindAsEventListener(this))}var f=this.text,g=this.edit,h=this.inputElm;h.className=this.options.editStyle,h.style.border="none",Element.hide(f),Element.show(g),this.type=="text"?(h.value=this.data.convertHTMLToText(),Field.activate(h)):this.type=="area"&&(h.value=this.data.convertHTMLToText(),Field.setCursorToEnd(h)),this.refreshSize(),this.lastData=this.data,Event.observe(h,"keyup",this.refreshSize.bindAsEventListener(this)),this.options.showBtn||Event.observe(h,"blur",this.finish.bindAsEventListener(this)),this.type=="text"&&Event.observe(h,"keydown",this.onEnterDown.bindAsEventListener(this))},finish:function(){if(!this.editing)return!1;var a=this.inputElm.value;this.type=="text"?this.data=a===""?this.options.defaultValue||"":a.escapeHTML():this.type=="area"&&(this.data=a===""?this.options.defaultValue||"":a.convertTextToHTML()),Element.hide(this.edit),this.text.innerHTML=this.options.filter(this.data),Element.show(this.text),Element.hide(this.edit),this.options.showBtn&&this.hideBtn(),this.editing=!1,this.setOut(),this.data!=this.lastData&&this.options.onChange&&this.options.onChange(this.data)},cancel:function(){if(!this.editing)return!1;this.text.innerHTML=this.options.filter(this.lastData),Element.hide(this.edit),Element.show(this.text),this.hideBtn(),this.editing=!1,this.setOut()},hideBtn:function(){Element.remove(this.obj.nextSibling)},refreshSize:function(){if(!this.editing)return!1;var a=this.text,b=this.inputElm;Element.show(a),this.type=="text"?(a.style.whiteSpace="nowrap",a.innerHTML=b.value.escapeHTML(),b.style.width=Math.min(parseInt(a.offsetWidth)+20,this.options.maxSize)+"px",b.style.height=parseInt(a.offsetHeight)+"px"):this.type=="area"&&(a.innerHTML=b.value.convertTextToHTML(),b.style.width=parseInt(a.offsetWidth)-4+"px",b.style.height=Math.min(parseInt(a.offsetHeight)+20,this.options.maxSize)+"px"),Element.hide(a)},onEnterDown:function(){if(!this.editing)return!1;window.event.keyCode==Event.KEY_RETURN&&this.finish()}},App.Resizables={resizes:[],activeResizable:null,register:function(a){this.resizes.length===0&&(this.eventMouseUp=this.end.bindAsEventListener(this),this.eventMouseMove=this.resize.bindAsEventListener(this),this.eventKeypress=this.keyPress.bindAsEventListener(this),Event.observe(document,"mouseup",this.eventMouseUp),Event.observe(document,"mousemove",this.eventMouseMove),Event.observe(document,"keypress",this.eventKeypress)),this.resizes.push(a)},unregister:function(a){this.resizes=this.resizes.reject(function(b){return b==a}),this.resizes.length===0&&(Event.stopObserving(document,"mouseup",this.eventMouseUp),Event.stopObserving(document,"mousemove",this.eventMouseMove),Event.stopObserving(document,"keypress",this.eventKeypress))},activate:function(a){window.focus(),this.activeResizable=a},deactivate:function(a){this.activeResizable=null},resize:function(a){if(!this.activeResizable)return;var b=[Event.pointerX(a),Event.pointerY(a)];if(this._lastPointer&&this._lastPointer.inspect()==b.inspect())return;this._lastPointer=b,this.activeResizable.resize(a)},end:function(a){if(!this.activeResizable)return;this._lastPointer=null,this.activeResizable.end(a),this.activeResizable=null},keyPress:function(a){this.activeResizable&&this.activeResizable.keyPress(a)}},App.Resizable=Class.create(),App.Resizable.prototype={initialize:function(a,b){this.element=$(a),this.options=Object.extend({able:!0,borderStart:0,border:10,zindex:1e3,constraint:!1,snap:!1,defaultWidth:null,defaultHeight:null},b||{});if(this.options.addons){if(this.options.addons.constructor!=Array){var c=this.options.addons;this.options.addons=[],this.options.addons.push(c)}this.options.addons=$A(this.options.addons).map(function(a){if(a&&typeof a=="string")var b=document.getElementsByClassName(a,this.element)[0];return b||(b=$(a)),b}.bind(this))}Element.cleanWhitespace(this.element),(b.defaultWidth||b.defaultHeight)&&this.resizeTo(b.defaultWidth,b.defaultHeight),this.eventMouseMove=this.over.bindAsEventListener(this),this.eventMouseDown=this.start.bindAsEventListener(this),Event.observe(this.element,"mousemove",this.eventMouseMove),Event.observe(this.element,"mousedown",this.eventMouseDown),App.Resizables.register(this)},destroy:function(){Event.stopObserving(this.element,"mousemove",this.eventMouseMove),Event.stopObserving(this.element,"mousedown",this.eventMouseDown),this.options.addons&&this.options.addons.each(function(a){a.style.width=a._originalWidth||"",a.style.height=a._originalHeight||"",a._originalWidth=null,a._originalHeight=null}.bind(this)),App.Resizables.unregister(this)},over:function(a){if(!this.options.able)return!1;if(App.Resizables.activeResizable)return!1;var b=this.getOffset(a),c=[this.element.offsetWidth,this.element.offsetHeight],d=this.options.constraint?[this.options.constraint=="horizontal",this.options.constraint=="vertical"]:[!0,!0];this.resizeXY=[0,1].map(function(a){var e;return this.options.borderStart instanceof Array?e=this.options.borderStart[a]:e=this.options.borderStart,d[a]&&b[a]<c[a]-e&&b[a]>c[a]-e-this.options.border}.bind(this)),this.element.style.cursor=this.resizeXY[0]||this.resizeXY[1]?(this.resizeXY[1]?"s":"")+(this.resizeXY[0]?"e":"")+"-resize":"default"},start:function(a){if(!this.resizeXY||!this.resizeXY[0]&&!this.resizeXY[1])return;var b=this.getOffset(a),c=this.getDis(this.element),d=[parseInt(Element.getStyle(this.element,"width"))||this.element.offsetWidth-c[0],parseInt(Element.getStyle(this.element,"height"))||this.element.offsetHeight-c[1]];this.sm=[0,1].map(function(a){return d[a]-b[a]}),this.options.addons&&this.options.addons.each(function(a){a.addonDis=this.getDis(a),a.addonSize=[parseInt(Element.getStyle(a,"width"))||a.offsetWidth-a.addonDis[0],parseInt(Element.getStyle(a,"height"))||a.offsetHeight-a.addonDis[1]],a.sm=[0,1].map(function(c){return a.addonSize[c]-b[c]})}.bind(this)),App.Resizables.activate(this)},resize:function(a){this.resizing||(this.resizing=!0,this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0),this.element.style.zIndex=this.options.zindex),this.draw(a),this.options.change&&this.options.change(this),App.cancelBubble(a)},draw:function(a){var b=this.getOffset(a),c=[0,1].map(function(a){return b[a]+this.sm[a]}.bind(this));this.options.snap&&(typeof this.options.snap=="function"?c=this.options.snap(this.element,c[0],c[1]):this.options.snap instanceof Array?c=c.map(function(a,b){return Math.round(a/this.options.snap[b])*this.options.snap[b]}.bind(this)):c=c.map(function(a){return Math.round(a/this.options.snap)*this.options.snap}.bind(this)));var d=[0,1].map(function(a){return c[a]-this.sm[a]}.bind(this));this.options.addons&&this.options.addons.each(function(a){this.resizeXY[0]&&(a.style.width=Math.max(a.sm[0]+d[0],0)+"px"),this.resizeXY[1]&&(a.style.height=Math.max(a.sm[1]+d[1],0)+"px")}.bind(this)),this.resizeXY[0]&&(this.element.style.width=Math.max(c[0],0)+"px"),this.resizeXY[1]&&(this.element.style.height=Math.max(c[1],0)+"px")},end:function(a){if(!this.resizing)return;this.resizing=!1,this.options.zindex&&(this.element.style.zIndex=this.originalZ),App.Resizables.deactivate(this),this.options.update&&this.options.update(this),App.cancelBubble(a)},resizeTo:function(a,b){var c=[a,b],d=this.getDis(this.element),e=[parseInt(Element.getStyle(this.element,"width"))||Element.getDimensions(this.element).width-d[0],parseInt(Element.getStyle(this.element,"height"))||Element.getDimensions(this.element).height-d[1]],f=[0,1].map(function(a){return c[a]-e[a]});this.options.addons&&this.options.addons.each(function(a){a.addonDis=this.getDis(a),a.addonSize=[parseInt(Element.getStyle(a,"width"))||Element.getDimensions(a).width-a.addonDis[0],parseInt(Element.getStyle(a,"height"))||Element.getDimensions(a).height-a.addonDis[1]],a.ss=[0,1].map(function(b){return a.addonSize[b]+f[b]}),a._originalWidth=a.style.width,a._originalHeight=a.style.height,c[0]&&(a.style.width=a.ss[0]+"px"),c[1]&&(a.style.height=a.ss[1]+"px")}.bind(this)),c[0]&&(this.element.style.width=Math.max(c[0],0)+"px"),c[1]&&(this.element.style.height=Math.max(c[1],0)+"px")},adjustSize:function(a,b){var c=this.getDis(this.element.firstChild),d=[parseInt(Element.getStyle(this.element.firstChild,"width"))+c[0]||Element.getDimensions(this.element.firstChild).width,parseInt(Element.getStyle(this.element.firstChild,"height"))+c[1]||Element.getDimensions(this.element.firstChild).height],e=this.getDisPadding(this.element);a&&(this.element.style.width=d[0]+e[0]+"px"),b&&(this.element.style.height=d[1]+e[1]+"px")},getOffset:function(a){var b=[Event.pointerX(a),Event.pointerY(a)],c=Position.cumulativeOffset(this.element),d=[0,1].map(function(a){return b[a]-c[a]});return d},getDisPadding:function(a){var b=[0+(parseInt(Element.getStyle(a,"padding-left"))||0)+(parseInt(Element.getStyle(a,"padding-right"))||0),0+(parseInt(Element.getStyle(a,"padding-top"))||0)+(parseInt(Element.getStyle(a,"padding-top"))||0)];return b},getDisBorder:function(a){var b=[0+(parseInt(Element.getStyle(a,"border-left-width"))||0)+(parseInt(Element.getStyle(a,"border-right-width"))||0),0+(parseInt(Element.getStyle(a,"border-top-width"))||0)+(parseInt(Element.getStyle(a,"border-bottom-width"))||0)];return b},getDis:function(a){var b=[0,1].map(function(b){return 0+this.getDisPadding(a)[b]+this.getDisBorder(a)[b]}.bind(this));return b},keyPress:function(a){if(!a.keyCode==Event.KEY_ESC)return;this.end(a)}},App.Requester={orderObj:null,floatObj:[],request:function(a,b){switch(a){case"new":case"del":case"newPage":case"delPage":case"editPageTitle":case"editPageColStyle":case"editPageIco":case"editPagePermit":case"editPageMods":case"editPage":case"pageOrder":case"customTheme":case"customThemeClean":case"theme":case"themeGW":case"styleAll":case"userData":this.doSend(a,b);break;case"edit":if(!b.options.id){b.endSave();return}this.doSend(a,b);break;case"order":this.doSend(a,b);break;case"float":this.floatObj.length===0&&(this.eventSendFloat=this.sendFloatAll.bind(this),Event.observe(window,"unload",this.eventSendFloat)),$A(this.floatObj).include(b.options.id)||this.floatObj.push(b.options.id);break;default:return}},sendFloatAll:function(){$A(this.floatObj).each(function(a){$(a)&&this.doSend("float",App.Modules.getObjByElement($(a)))}.bind(this))},doSend:function(a,b){LoadBar.show();var c="",d={};switch(a){case"userData":LoadBar.show(App.Lang.loadUserModule),c=App.Actions.userData+"m_list-ebi_"+_ebi+"/module/",App.Permit.editModule&&(c+="?o=true"),d={data:{okFun:App.UserData.response.bind(App.UserData)}};break;case"order":c=App.Actions.editMod,b=b||this.orderObj,d={parameters:"m=update&id="+b.id+"&type=order&data="+JSON.stringify(b.data),method:"post"};break;case"new":c=App.Actions.newMod,d={parameters:"m=save&type="+b.options.type+"&title="+escape(b.options.title)+"&data="+escape(JSON.stringify(b.options.data)||""),data:{okFun:App.Modules.doNewMod.bind(App.Modules)},method:"post"};break;case"edit":c=App.Actions.editMod,d={parameters:"m=update&id="+b.options.id+"&type="+b.options.type+"&title="+escape(b.options.title)+"&data="+escape(JSON.stringify(b.options.data)||""),data:{okFun:b.endSave.bind(b)},method:"post"};break;case"del":c=App.Actions.delMod,d={parameters:"m=delete&id="+b.options.id,data:{okFun:b.doClose.bind(b)}};break;case"newPage":c=App.Actions.newPage,d={parameters:"m=save&type="+b.options.type+"&title="+escape(b.options.title)+"&ico="+b.options.ico+"&colStyle="+b.options.colStyle+"&permit="+b.options.permit+"&widget="+JSON.stringify(b.options.widgets),data:{okFun:App.PageTabs.analyseNewPageTab.bind(App.PageTabs)},method:"post"};break;case"delPage":c=App.Actions.delPage,d={parameters:"m=delete&id="+b.options.id,data:{okFun:b.doClose.bind(b)}};break;case"editPageTitle":c=App.Actions.editPage,d={parameters:"m=update&id="+b.options.id+"&type="+b.options.type+"&title="+escape(b.newTitle),data:{okFun:b.doSaveTitle.bind(b)},method:"post"};break;case"editPageColStyle":c=App.Actions.editPage,d={parameters:"m=update&id="+b.options.id+"&colStyle="+escape(b.newColStyle),data:{okFun:b.doSetColStyle.bind(b)},method:"post"};break;case"editPageIco":c=App.Actions.editPage,d={parameters:"m=update&id="+b.options.id+"&ico="+escape(b.newIco),data:{okFun:b.doSetIcon.bind(b)},method:"post"};break;case"editPagePermit":c=App.Actions.editPage,d={parameters:"m=update&id="+b.options.id+"&permit="+escape(b.newPermit),data:{okFun:b.doSetPermit.bind(b)},method:"post"};break;case"editPageMods":c=App.Actions.editPage,d={parameters:"m=update&id="+b.options.id+"&mods="+JSON.stringify(b.newMods),method:"post"};break;case"editPage":c=App.Actions.editPage,d={parameters:"m=update&id="+b.options.id+"&title="+escape(b.options.title)+"&ico="+b.options.ico+"&colStyle="+b.options.colStyle+"&permit="+b.options.permit+"&mods="+JSON.stringify(b.options.mods),method:"post"};break;case"pageOrder":c=App.Actions.editPage,d={parameters:"m=update&layout="+JSON.stringify(b.data),method:"post"};break;case"theme":c=App.Actions.theme,d={parameters:"m=update&v=xml&theme="+b,data:{okFun:App.Themes.doSetTheme.bind(App.Themes)},method:"post"};break;case"themeGW":c=App.Actions.themeGW,d={parameters:"m=update&v=xml&greenThemeId="+b.themeCode+"&vcode="+b.vcode+"&vcodeEn="+escape(b.vcodeEn),data:{okFun:App.Framework.okSetThemeGW.bind(App.Framework),errorFun:App.Framework.errorSetThemeGW.bind(App.Framework)},method:"post"};break;case"customTheme":c=App.Actions.customTheme,d={parameters:"m=update&v=xml&"+b,data:{okFun:App.UserStyle.saveOk.bind(App.UserStyle)},method:"post"};break;case"customThemeClean":c=App.Actions.customTheme,d={parameters:"m=clean&v=xml",data:{okFun:App.UserStyle.cleanOk.bind(App.UserStyle)},method:"post"};break;case"styleAll":c=App.Actions.customTheme,d={parameters:"m=updateAll&v=xml&"+b,data:{okFun:App.UserStyle.styleAllOk.bind(App.UserStyle)},method:"post"};break;case"float":c=App.Actions.editMod,d={parameters:"id="+b.options.id+"&floating="+JSON.stringify(b.options.floating)};break;case"expand":c=App.Actions.editMod,d={parameters:"id="+b.options.id+"&isExpanded="+JSON.stringify(b.options.isExpanded)}}this.doRequest(c,d)},doRequest:function(a,b){b=Object.extend({method:"get",onSuccess:App.Response.analyse.bind(App.Response)},b||{});var c=new App.ImpFile(a,b)}},App.Response={analyse:function(a,b,c){LoadBar.hide();if(!a)return this.connetionError();if(!a.responseText)return this.connetionError();if(a.responseText.indexOf("<?")!==0)return this.notWebFormed(a);if(!a.responseXML)return this.notWebFormed(a);var d=a.responseXML,e=Element.getChildValueByTagName(d,"code")[0],f=Element.getChildValueByTagName(d,"message")[0].trim();if(typeof e=="undefined"||typeof f=="undefined")return this.notWebFormed(a);c&&c.defaultFun&&typeof c.defaultFun=="function"&&c.defaultFun(e,f);if(e=="200"){var g=d.getElementsByTagName("data")[0];if(!c||!c.okFun||typeof c.okFun!="function")return g;c.okFun(g)}else this.reportError(e,f),c&&c.errorFun&&typeof c.errorFun=="function"&&c.errorFun(e,f)},connetionError:function(){var a=App.Lang.error+": "+App.Lang.connetionError+"\n\n";return a+=App.Lang.cannotGetConnetion+"\n",a+=App.Lang.contactAdmin+"\n",alert(a),null},notWebFormed:function(a){var b=App.Lang.error+": "+App.Lang.analyseFileError+"\n\n";return b+=App.Lang.notWellFormed+"\n",b+=App.Lang.contactAdmin+"\n",b+="-------------------------\n",b+=a.responseText.length<=100?a.responseText:a.responseText.substring(0,100)+"...",alert(b),null},reportError:function(a,b){if(a=="401"){var c=App.Lang.notLogon+"\n\n";c+=App.Lang.pleaseLogon;if(confirm(c)){location.href="http://blog.sohu.com/login/logon.do";return}}if(a=="403"){var c=App.Lang.noPermitOrNotLogon+"\n\n";c+=App.Lang.pleaseLogon;if(confirm(c)){location.href="http://blog.sohu.com/login/logon.do";return}}else{var c="";c+=Info.htmlInfo(unescape(b),1," "),alert(c)}return null}},App.Framework={initialize:function(){App.Permit.ableLog&&$LT("App.Framework.initialize"),!App.Permit.editHead,App.Framework.initNavBar(),App.Framework.indiBtnCntn=$("optionNav"),App.Framework.initThemeBtn();if(App.Permit.editTheme){var a=window.location.hash;a&&a.length>1&&(a=a.split("#method_"),a.length==2&&a[1].length>0&&(a[1]=="settheme"?Event.observe(window,"load",App.Framework.setTheme.bind(App.Framework)):a[1]=="custtheme"&&Event.observe(window,"load",App.UserStyle.customTheme.bind(App.UserStyle))))}App.UserData.load()},initNavBar:function(){App.Permit.ableLog&&$LT("App.Framework.initNavBar"),this._mainNavBar=$("mainNav");var a=[];a.push("<ul></ul>"),this._mainNavBar.innerHTML=a.join(""),a=null,this.elm_navBar=this._mainNavBar.firstChild},showNewPageBtn:function(){this.initNewPageBtn()},initNewPageBtn:function(){App.Permit.ableLog&&$LT("App.Framework.initNewPageBtn");var a=document.createElement("span");this.elm_newPageBtn=a,a.id="newPageBtn",a.innerHTML='<a href="javascript:void(0)" onfocus="this.blur()" onmousedown="CA.q(\'blog_addPage\');">'+App.Lang.newPageBtn+"</a>",this._mainNavBar.appendChild(a),Event.observe(a,"click",App.cancelBubble.bindAsEventListener(this)),Event.observe(a,"click",this.newPage.bindAsEventListener(this))},getNewPageMenuData:function(){var a=[];return $A(App.PageLib.lib).each(function(b){var c=!1,d="",e="";b.only&&App.PageTabs.getPTabByType(b.type).length>0&&(c=!0,d+='<img src="'+App.Actions.imgPath+'ico_tick_small.gif" />',e+=App.Lang.alreadyInUse);if(b.demo&&!App.Permit.ableDemo)throw $continue;if(b.dev&&!App.Permit.able3rdDev&&!App.Permit.ableDemo)throw $continue;if(b.toy&&!App.Permit.ableToy&&!App.Permit.ableDemo)throw $continue;var f={text:'<img src="'+(b.ico!=0?App.Actions.imgPath+App.Actions.icoShortPath+App.icoLib[b.ico]:App.Actions.imgPath+"spacer.gif")+'" alt="'+b.title+'" /> '+(b.title?b.title:App.Lang.customPage)+d+(b.toy?"*":"")+(b.demo?"**":""),title:b.desc+(c?" ("+e+")":""),action:App.PageTabs.newPageTab.bind(App.PageTabs),value:b.type,disabled:c};a.push(f)}.bind(this)),[{title:null,active:!0,data:a}]},newPage:function(){if(!this.newPageMenu){var a={menuData:this.getNewPageMenuData(),title:null,clsBtn:!1,autoCls:!0,autoActive:!1,btn:this.elm_newPageBtn,zIndex:500,sDivCss:"menuSub-div menuSub-div-newPage"};this.newPageMenu=new WinMenu(a)}this.newPageMenu.win.showing?this.newPageMenu.hide():this.newPageMenu.show()},updateNewPageMenuContent:function(){if(!this.newPageMenu)return;this.newPageMenu.updateMenuData(this.getNewPageMenuData())},initModContainer:function(){var a=$("mainWrapper"),b=[];b.push('<div id="innerMainWrapper">'),b.push('<div style="display:none"></div>'),b.push('<div id="modContainer">'),b.push("</div>"),b.push("</div>"),a.innerHTML=b.join(""),this.elm_modCtnInfo=a.firstChild.firstChild,this.elm_modCtn=a.firstChild.lastChild},initThemeBtn:function(){if(App.Permit.editTheme){App.Permit.ableLog&&$LT("App.Framework.initThemeBtn");var a=document.createElement("li");this.elm_themeBtn=a;var b='<a href="javascript:void(0)" onfocus="this.blur()" class="navEditTheme" onmousedown="CA.q(\'blog_editTheme\');">'+App.Lang.setTheme+"</a>";App.ThemeLib.hasNew&&(b+='<img src="'+App.Actions.imgPath+'ico_new.gif" alt="'+App.Lang.hasNewTheme+'" title="'+App.Lang.hasNewTheme+'" class="new" />'),a.innerHTML=b,this.indiBtnCntn.insertBefore(a,this.indiBtnCntn.firstChild),Event.observe(a,"click",this.setTheme.bindAsEventListener(this))}else{var a=document.createElement("li");this.elm_userThemeBtn=a;var b='<a href="javascript:void(0)" onfocus="this.blur()" class="navEditTheme" onmousedown="CA.a(\'useTheme\');">使用此博客主题</a>';a.innerHTML=b,this.indiBtnCntn.insertBefore(a,this.indiBtnCntn.firstChild),Event.observe(a,"click",this.useTheme.bindAsEventListener(this))}},initNewModBtn:function(){App.Permit.ableLog&&$LT("App.Framework.initNewModBtn");var a=document.createElement("li");this.elm_newModBtn=a;var b='<a href="http://blog.sohu.com/manage/setting.do?m=newEdit" class="navSysOpt" >博客设置</a>&nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" onfocus="this.blur()" class="navNewMod" onmousedown="CA.q(\'blog_addMod\');">'+App.Lang.newModule+"</a>";App.WidgetLib.hasNew&&(b+='<img src="'+App.Actions.imgPath+'ico_new.gif" alt="'+App.Lang.hasNewWidget+'" title="'+App.Lang.hasNewWidget+'" class="new" />'),a.innerHTML=b,this.indiBtnCntn.insertBefore(a,this.indiBtnCntn.firstChild),Event.observe(a,"click",this.newMod.bindAsEventListener(this))},getNewModMenuData:function(){var a=[];return $A(App.WidgetLib.gallery).each(function(b,c){if(b.demo&&!App.Permit.ableDemo)throw $continue;if(b.dev&&!App.Permit.able3rdDev&&!App.Permit.ableDemo)throw $continue;if(b.toy&&!App.Permit.ableToy&&!App.Permit.ableDemo)throw $continue;if(b.type=="function")var d=this._reqMods.bind(this,b);else{var d=[];$A(App.WidgetLib.lib).each(function(a){if(a.gal!=b.key)throw $continue;var c=!1,e="",f="";a.only&&App.UserData.getModByType(a.type)&&(c=!0,e+='<img src="'+App.Actions.imgPath+'ico_tick_small.gif" />',f+=App.Lang.alreadyInUse);var h=App.PageTabs.getActivePTab();a.private&&h&&h.options.permit==0&&(c=!0,e+='<img src="'+App.Actions.imgPath+'ico_warn_small.gif" />',f+=App.Lang.onlyInPrivatePage);if(a.demo&&!App.Permit.ableDemo)throw $continue;if(a.dev&&!App.Permit.able3rdDev&&!App.Permit.ableDemo)throw $continue;if(a.toy&&!App.Permit.ableToy&&!App.Permit.ableDemo)throw $continue;var i={text:'<img src="'+a.ico+'" alt="'+a.title+'" /> '+a.title+e+(a.toy?"<span>*</span>":"")+(a.demo?"**":"")+(a.isNew?'<img src="'+App.Actions.imgPath+'ico_new.gif" alt="'+App.Lang.newWidget+'" title="'+App.Lang.newWidget+'" class="new" />':""),title:a.desc+(c?" ("+f+")":a.sys?" ("+App.Lang.sysMod+")":""),action:App.Modules.newMod.bind(App.Modules),value:a.type,disabled:c};d.push(i)}.bind(this))}a.push({title:b.title+(b.hasNew||b.isNew?' <img src="'+App.Actions.imgPath+'ico_new.gif" alt="'+App.Lang.hasNewWidget+'" title="'+App.Lang.hasNewWidget+'" class="new" />':"")+(b.toy?"*":"")+(b.demo?"**":""),active:c==0,data:d})}.bind(this)),a},_reqMods:function(a,b){var c=this.newModMenu.options,d=c.menuData[b].isDivCssEx,e=document.createElement("div");return e.className=c.isDivCss+" clearfix",d&&Element.addClassName(e,d),e.innerHTML=App.Lang.loadModuleData,new Groj(a.dataUrl,{variable:"ow_recmd_widgets",onSuccess:this._getMods.bind(this,b),onFailure:this._notGetMods.bind(this,b)}),e},_getMods:function(a,b){if(b)if(b.status==0)if(b.data&&b.data.length){b.data;var c=[];b.data.each(function(a){c.push({text:'<img src="'+a.icon+'" alt="'+a.title+'" /> '+a.title,title:a.description,action:App.Modules.newOwMod.bind(App.Modules),value:a.link,disabled:!1})}),this.newModMenu.options.menuData[a].data=c,this.newModMenu.updateSubContent(a)}else this._notGetMods(a,this.newModMenu.options.noneInfo);else this._notGetMods(a,b.statusText);else this._notGetMods(a,App.Lang.notWellFormed)},_notGetMods:function(a,b){this.newModMenu.elm_subConts[a].innerHTML=typeof trasport=="string"?b:b.statusText},newMod:function(){if(!this.newModMenu){var a=document.createElement("div");a.className="more",a.innerHTML=App.Lang.moreMod;var b={menuData:this.getNewModMenuData(),title:App.Lang.newModule,autoActive:!1,btn:this.elm_newModBtn,displace:[-210,0],noneInfo:App.Lang.noWidget,zIndex:500,sDivCss:"menuSub-div menuSub-div-newMod",elm_extendBottom:a};this.newModMenu=new WinMenu(b)}this.newModMenu.win.showing?this.newModMenu.hide():(this.setThemeMenu&&this.setThemeMenu.win.showing&&this.setThemeMenu.hide(),this.newModMenu.show())},updateNewModMenuContent:function(){if(!this.newModMenu)return;this.newModMenu.updateMenuData(this.getNewModMenuData())},getGreenWaySubMenuData:function(a){this.setThemeMenu.index=a;var b=document.createElement("div");b.className="menuInnerSub-div clearfix menuInnerSub-div-theme";var c=[];return c.push('<form method="post" onsubmit="return false;">'),c.push('<table style="clear:both;" cellpadding="2" cellspacing="5">'),c.push('<tr><td width="55" valign="top">'),c.push(App.Lang.greenWay+":"),c.push("</td><td>"),c.push(App.Lang.blogworldSohuGWThemes),c.push("</td></tr>"),c.push("<tr><td>"),c.push(App.Lang.gwCode+":"),c.push("</td><td>"),c.push('<input type="text" name="themeCode" class="text" /> <span style="font-weight:bold; cursor:pointer; padding:0px 4px; border:1px solid #ccc;" title="'+App.Lang.whatisGW+'">?</span>'),c.push("</td></tr>"),c.push('<tr style="display:none"><td>&nbsp;</td><td>'),c.push('<div class="infoBox" style="float:none;">'),c.push(App.Lang.gwInfoText),c.push("</div>"),c.push("</td></tr>"),c.push('<tr style="display:none;"><td>'),c.push(App.Lang.vCode+":"),c.push("</td><td>"),c.push("</td></tr>"),c.push("<tr><td>"),c.push('&nbsp;</td><td><input type="submit" class="button-submit" value="'+App.Lang.ok+'" />'),c.push('<span style="display:none;">'+App.Lang.loading+"</span>"),c.push("</td></tr>"),c.push("</table>"),c.push('<div className="clearfix" style="clear:both;"></div>'),c.push("</form>"),b.innerHTML=c.join(""),this.setThemeMenu.gwForm=b.firstChild,this.setThemeMenu.gwCodeIpt=b.firstChild.firstChild.rows[1].cells[1].firstChild,this.setThemeMenu.gwInfoBtn=b.firstChild.firstChild.rows[1].cells[1].lastChild,this.setThemeMenu.gwInfoText=b.firstChild.firstChild.rows[2],this.setThemeMenu.gwVCodeBox=b.firstChild.firstChild.rows[3],this.setThemeMenu.gwCodeSubmitBtn=b.firstChild.firstChild.rows[4].cells[1].firstChild,this.setThemeMenu.gwCodeSubmitLoadText=b.firstChild.firstChild.rows[4].cells[1].lastChild,this.setThemeMenu.greenWaySubMenu=b.firstChild.lastChild,Event.observe(this.setThemeMenu.gwForm,"submit",this.submitGreenWayCode.bindAsEventListener(this)),Event.observe(this.setThemeMenu.gwCodeIpt,"focus",this.showGreenWayVCode.bindAsEventListener(this)),Event.observe(this.setThemeMenu.gwInfoBtn,"click",function(){Element.toggle(this.setThemeMenu.gwInfoText)}.bind(this)),setTimeout(this.loadGreenWayData.bind(this,a),10),b},showGreenWayVCode:function(){if(this.setThemeMenu.gwVCodeBox.lastChild.innerHTML!="")return;var a=[];a.push('<input name="vcode" type="text" class="text" id="vcode" value="" size="4" maxlength="4" />&nbsp;'),a.push("<span></span>&nbsp;"),a.push('<a href="javascript:void(0)">'+App.Lang.cannotSeeVCode+"</a>"),this.setThemeMenu.gwVCodeBox.lastChild.innerHTML=a.join(""),this.setThemeMenu.gwVCodeCon=this.setThemeMenu.gwVCodeBox.lastChild.getElementsByTagName("span")[0],this.setThemeMenu.gwVCodeRefresh=this.setThemeMenu.gwVCodeBox.lastChild.lastChild,this.setThemeMenu.gwVCodeRefresh.onclick=function(){new VCode(this.setThemeMenu.gwVCodeCon)}.bind(this),new VCode(this.setThemeMenu.gwVCodeCon),Element.show(this.setThemeMenu.gwVCodeBox)},submitGreenWayCode:function(){return Form.getInputs(this.setThemeMenu.gwForm,"text","themeCode")[0].value?Form.getInputs(this.setThemeMenu.gwForm,"text","vcode")[0].value?(this.setThemeMenu.gwCodeSubmitBtn.disabled=!0,Element.show(this.setThemeMenu.gwCodeSubmitLoadText),App.Requester.request("themeGW",{themeCode:Form.getInputs(this.setThemeMenu.gwForm,"text","themeCode")[0].value,vcode:Form.getInputs(this.setThemeMenu.gwForm,"text","vcode")[0].value,vcodeEn:Form.getInputs(this.setThemeMenu.gwForm,"hidden","vcodeEn")[0].value}),!1):(alert(App.Lang.plsEnterVCode),Form.getInputs(this.setThemeMenu.gwForm,"text","vcode")[0].focus(),!1):(alert(App.Lang.plsEnterGWCode),Form.getInputs(this.setThemeMenu.gwForm,"text","themeCode")[0].focus(),!1)},okSetThemeGW:function(a){var b=Element.getChildValueByTagName(a,"theme")[0]||"";b||this.errorSetThemeGW(),App.Themes.doSetThemeGW(b),this.endSubmitGreenWayCode(),this.setThemeMenu.gwCodeIpt.value="",this.setThemeMenu.gwVCodeBox.lastChild.innerHTML="",Element.hide(this.setThemeMenu.gwVCodeBox),this.setThemeMenu.hide(),this.updateGreenWayData()},errorSetThemeGW:function(){this.endSubmitGreenWayCode()},endSubmitGreenWayCode:function(){Form.getInputs(this.setThemeMenu.gwForm,"text","vcode")[0]&&(Form.getInputs(this.setThemeMenu.gwForm,"text","vcode")[0].value=""),new VCode(this.setThemeMenu.gwVCodeCon),this.setThemeMenu.gwCodeSubmitBtn.disabled=!1,Element.hide(this.setThemeMenu.gwCodeSubmitLoadText)},updateGreenWayData:function(){this.loadGreenWayData(this.setThemeMenu.index)},loadGreenWayData:function(a){var b=App.Actions.greenWay+"?mail="+getP()+"&nocache="+timeStamp();new LinkFile(b,{type:"script",callBack:{variable:"gw_codes",onLoad:this.showGreenWayData.bind(this,a),onFailure:function(){this.greenWaySubMenu.innerHTML=""}.bind(this)}})},showGreenWayData:function(a){if(gw_codes.length>0){if(!this.setThemeMenu.greenWaySubTitle){var b=document.createElement("div");this.setThemeMenu.greenWaySubTitle=b,b.style.clear="both",b.style.styleFloat="none",b.style.width="auto",b.style.padding="5px 0px",b.style.margin="0px 5px",b.style.borderTop="1px solid #ccc",this.setThemeMenu.greenWaySubMenu.parentNode.insertBefore(b,this.setThemeMenu.greenWaySubMenu)}this.setThemeMenu.greenWaySubTitle.innerHTML=App.Lang.myGWTheme+":"}this.setThemeMenu.greenWaySubMenu.innerHTML="",gw_codes.each(function(b,c){var d={id:b.id,grp:"gw",code:b.code};App.ThemeLib.add(d),d=App.ThemeLib.getTheme(d.id);var e={text:'<img src="'+(d.path||App.Actions.themePath+d.id+"/")+d.smp+'" alt="'+(d.name||d.id)+'" />',title:d.name||d.id,action:App.Themes.setTheme.bind(App.Themes),value:d.id,active:App.theme==d.id},f=document.createElement("div");f.className=this.options.sOutCss,e.active&&Element.addClassName(f,this.options.sActiveCss),e.disabled&&Element.addClassName(f,this.options.sDisableCss),f.innerHTML=e.text,e.text&&(f.title=e.title||e.text),Event.observe(f,"mouseover",function(){if(e.disabled)return;Element.addClassName(f,this.options.sOverCss)}.bind(this)),Event.observe(f,"mouseout",function(){if(e.disabled)return;Element.removeClassName(f,this.options.sOverCss),Element.removeClassName(f,this.options.sDownCss)}.bind(this)),Event.observe(f,"mousedown",function(){if(e.disabled)return;Element.addClassName(f,this.options.sDownCss)}.bind(this)),Event.observe(f,"mouseup",function(){if(e.disabled)return;Element.removeClassName(f,this.options.sDownCss)}.bind(this)),Event.observe(f,"click",function(){if(e.disabled)return;this.options.autoActive&&this.activeItem(a,c),e.action(e.value),this.options.click2cls&&this.hide()}.bind(this)),this.greenWaySubMenu.appendChild(f)}.bind(this.setThemeMenu))},getCustomThemeSubMenuData:function(a){this.setThemeMenu.index=a;var b=document.createElement("div");b.className="menuInnerSub-div clearfix menuInnerSub-div-theme";var c="";return c+='<input type="button" style="margin:5px 0 5px 20px;" value="'+App.Lang.customTheme+'" />',c+='<input type="button" style="margin:5px 0 5px 20px;" value="'+App.Lang.shareTheme+'" />',b.innerHTML=c,this.setThemeMenu.cusThemeBtn=b.firstChild,this.setThemeMenu.shareThemeBtn=b.childNodes[1],Event.observe(this.setThemeMenu.cusThemeBtn,"click",function(){App.UserStyle.customTheme(),this.setThemeMenu.hide()}.bind(this)),Event.observe(this.setThemeMenu.shareThemeBtn,"click",App.UserStyle.shareTheme.bind(App.UserStyle)),b},getSetThemeMenuData:function(){var a=[];return $A(App.ThemeLib.group).each(function(b,c){if(b.demo&&!App.Permit.ableDemo)throw $continue;if(b.dev&&!App.Permit.able3rdDev&&!App.Permit.ableDemo)throw $continue;if(b.toy&&!App.Permit.ableToy&&!App.Permit.ableDemo)throw $continue;if(b.key=="gw")var d=this.getGreenWaySubMenuData.bind(this);else if(b.key=="customTheme")var d=this.getCustomThemeSubMenuData.bind(this);else if(b.type=="function")var d=this._reqThemes.bind(this,b);else{var d=[];$A(App.ThemeLib.lib).each(function(a){if(a.grp!=b.key)throw $continue;if(a.demo&&!App.Permit.ableDemo)throw $continue;if(a.dev&&!App.Permit.able3rdDev&&!App.Permit.ableDemo)throw $continue;if(a.toy&&!App.Permit.ableToy&&!App.Permit.ableDemo)throw $continue;var c='<img src="'+(a.path||App.Actions.themePath+a.id+"/")+a.smp+'" alt="'+(a.name||a.id)+'" />';a.isNew&&(c+='<img src="'+App.Actions.imgPath+'ico_new.gif" alt="'+App.Lang.newTheme+'" title="'+App.Lang.newTheme+'" class="new" />');var e={text:c,title:a.name||a.id,action:App.Themes.setTheme.bind(App.Themes),value:a.code||a.id,active:App.theme==a.id};d.push(e)}.bind(this))}var e=null;b.more&&b.moreUrl&&(e='<div class="more" id="'+b.moreId+'" style="display:none;"><a href="'+b.moreUrl+'" target="_blank">'+b.moreTitle+"</a></div>"),a.push({title:b.title+(b.hasNew||b.isNew?' <img src="'+App.Actions.imgPath+'ico_new.gif" alt="'+App.Lang.hasNewTheme+'" title="'+App.Lang.hasNewTheme+'" class="new" />':"")+(b.toy?"*":"")+(b.demo?"**":""),active:c==0,isDivCssEx:"menuInnerSub-div-theme",itDivExtCss:b.itDivExtCss,data:d,more:e})}.bind(this)),a},_reqThemes:function(a,b){var c=this.setThemeMenu.options,d=c.menuData[b].isDivCssEx,e=document.createElement("div"),f=a.dataUrl.split("vn=")[1].split("&")[0];return e.className=c.isDivCss+" clearfix",d&&Element.addClassName(e,d),e.innerHTML=App.Lang.loadModuleData,new Groj(a.dataUrl,{variable:f,onSuccess:this._getThemes.bind(this,b,f),onFailure:this._notGetThemes.bind(this,b)}),e},_getThemes:function(a,b,c){if(c)if(c.status==0){b=="ow_my_themes"&&c.data.length>8?$("ow_my_themes_more").show():b=="ow_latest_themes"&&c.data.length==16&&$("ow_latest_themes_more").show();if(c.data&&c.data.length){c.data;var d=[];c.data.each(function(a){var c='<img src="'+a.thumbnail+'" alt="'+a.title+'" />',e=a.link;action=App.Themes.setOT.bind(App.Themes),b=typeof b=="string"?b:"",b=="ow_my_themes"?(c+='<span class="span_jsy">使用</span>',e=a.id,action=App.Themes.setTheme.bind(App.Themes)):b=="ow_latest_themes"&&(c+='<span class="span_jgm"><font>购买</font><b>￥</b>'+a.price+"</span>"),d.push({text:c,title:a.title,action:action,value:e,disabled:!1})}),this.setThemeMenu.options.menuData[a].data=d,this.setThemeMenu.updateSubContent(a)}else this._notGetThemes(a,this.setThemeMenu.options.noneInfo)}else this._notGetThemes(a,c.statusText);else this._notGetThemes(a,App.Lang.notWellFormed)},_notGetThemes:function(a,b){this.setThemeMenu.elm_subConts[a].innerHTML=typeof b=="string"?b:b.statusText},useTheme:function(){if(!isLogin()){setTimeout(function(){location.href=loginPath()},0);return}var a=App.UserStyle.getThemeType();if(a==2){new PopWin({type:"alert",content:"此主题为收费主题，请先去收费模板专区购买！"});return}new PopWin({type:"confirm",content:"确定要使用此博客主题吗？",okAction:function(){var b;switch(a){case 1:b="clean=true&theme="+App.UserStyle.getThemeId();break;case 3:b="clean=true&ot=false&theme="+App.UserStyle.getThemeId()+"&"+App.UserStyle.getCustomSets(!0);break;case 4:b="clean=true&ot=true&theme="+App.UserStyle.getThemeId()+"&"+App.UserStyle.getCustomSets(!0)}App.Requester.request("styleAll",b)}})},setTheme:function(){if(!this.setThemeMenu){var a=document.createElement("div");a.className="more",a.innerHTML=App.Lang.moreTheme;var b={menuData:this.getSetThemeMenuData(),title:App.Lang.setTheme,btn:this.elm_themeBtn,displace:[-495,0],zIndex:500,allInOne:!0,sDivCss:"menuSub-div menuSub-div-theme",elm_extendBottom:a};this.setThemeMenu=new WinMenu(b)}this.setThemeMenu.win.showing?this.setThemeMenu.hide():(this.newModMenu&&this.newModMenu.win.showing&&this.newModMenu.hide(),this.setThemeMenu.show())}},Starter.add(App.Framework.initialize),App.UserData={userModulesData:[],userModulseOrder:null,loaded:!1,load:function(){App.Permit.ableLog&&$LT("App.UserData.load"),this.userModulesData=[],this.userModulseOrder=null,typeof preloadUserData=="undefined"||!preloadUserData?App.Requester.request("userData"):(App.Permit.ableLog&&$LT("App.UserData load from page"),$A(preloadUserData).each(function(a){a.type=="order"?this.userModulseOrder=a:this.userModulesData.push(a)}.bind(this)),this.startInitModContainer())},response:function(a){this.analyse(a)},analyse:function(a){App.Permit.ableLog&&$LT("App.UserData.analyse");if(!a)return;var b=a.getElementsByTagName("mod");$A(b).each(function(a){var b=this.getModData(a);b.type=="order"?this.userModulseOrder=b:this.userModulesData.push(b)}.bind(this)),this.startInitModContainer()},startInitModContainer:function(){App.Framework.initModContainer(),this.createPage()},getModData:function(a){var b={id:a.getAttribute("id")||"",type:a.getAttribute("type")||"",isExpanded:a.getAttribute("isExpanded")?JSON.parse(a.getAttribute("isExpanded")):!0,share:a.getAttribute("share")?JSON.parse(a.getAttribute("share")):!0,floating:a.getAttribute("floating")?JSON.parse(a.getAttribute("floating")):!1,title:Element.getChildValueByTagName(a,"title")[0]||"",data:Element.getChildValueByTagName(a,"data")[0]?JSON.parse(Element.getChildValueByTagName(a,"data")[0])||Element.getChildValueByTagName(a,"data")[0]:""};return b},addMod:function(a){this.userModulesData.push(a)},delMod:function(a){this.userModulesData=this.userModulesData.reject(function(b){return b.id==a.id})},createPage:function(){LoadBar.show(App.Lang.createAllPages);var a="";if(location.hash){var b=location.hash;b.indexOf("#"+App.pageHash_prefix)==0&&(a=b.substring(2))}var c=!1;$A(this.userModulseOrder.data).each(function(b,d){if(!b.id)throw $continue;if(!App.Permit.ableViewPvtPageTab&&b.permit!=0)throw $continue;if(a==null||a=="")a=b.id;var e=App.PageLib.getPage(b.type);e||(e=App.PageLib.getPage("0"));var f=!1;if(a==b.id||a==e.hash)f=!0;var g={id:b.id,type:b.type||"0",ico:b.ico||58,title:b.title||App.Lang.defaultPageTitle,colStyle:b.colStyle||App.defaultColStyle,mods:b.mods||[],permit:b.permit||0,isActive:f&&!c,createMods:App.createOnlyFirstPageMod?f&&!c:!0},h=new App.PageTab(g);f&&(c=!0)}),LoadBar.hide(),App.Permit.editPageTab&&(App.Framework.showNewPageBtn(),App.PageTabs.regPageTabObservers(),App.Framework.initNewModBtn()),App.PageTabs.listenHash()},getModByType:function(a){return this.userModulesData.find(function(b){return b.type==a})}},App.PageTabs={pTabs:[],register:function(a){$(a.options.placeIn).appendChild(a.element),this.pTabs.push(a)},unregister:function(a){var b=0;this.pTabs=this.pTabs.reject(function(c,d){return c==a&&(b=d),c==a}),b--,b<0&&(b=0),b>=this.pTabs.length&&(b=this.pTabs.length-1),this.pTabs[b].active(),App.Framework.updateNewPageMenuContent()},disActiveAll:function(){this.pTabs.each(function(a){a.disActive()})},getActivePTab:function(){return this.pTabs.find(function(a){return a.options.isActive})},getPrivateTabs:function(){return this.pTabs.findAll(function(a){return a.options.permit!=0})},getPublicTabs:function(){return this.pTabs.findAll(function(a){return a.options.permit==0})},getProfileTabs:function(){return this.pTabs.findAll(function(a){return a.options.permit==2})},getPTabByElement:function(a){return this.pTabs.find(function(b){return b.element==a})},getPTabByType:function(a){return this.pTabs.findAll(function(b){return b.options.type==a})},hideOptMenuAll:function(){this.pTabs.each(function(a){a.hideOptMenu()})},setHash:function(a){this.stopListenHash();var b="";if(a)a.pl.type!="0"&&a.pl.hash?b=a.pl.hash:b=a.options.id;else{var c=this.pTabs.find(function(a){return a.options.isActive});c&&(c.pl.type!="0"&&c.pl.hash?b=c.pl.hash:b=c.options.id)}this.activePage=b,location.href="#t"+b,this.listenHash()},getHash:function(){var a="";location.hash&&location.hash.indexOf("#"+App.pageHash_prefix)==0&&(a=location.hash.substring(2)),a==App.profilePageHashId&&this.getProfileTabs().length>0&&(a=this.getProfileTabs()[0].options.id);if(a==this.activePage)return;if(a){var b=this.pTabs.find(function(b){var c=App.PageLib.getPage(b.options.type);return c||(c=App.PageLib.getPage("0")),b.options.id==a||c.hash==a});if(typeof b=="undefined"||!b)b=this.pTabs[0];typeof b!="undefined"&&b&&b.active(!0),this.activePage=a}},listenHash:function(){this.hashListener&&this.stopListenHash(),this.hashListener=setInterval(this.getHash.bind(this),1e3)},stopListenHash:function(){if(!this.hashListener)return;clearInterval(this.hashListener),this.hashListener=null},getNewPageTabsOrder:function(){var a=[],b=$A(App.Framework.elm_navBar.getElementsByTagName("li"));return $A(b).each(function(b){b.id&&a.push(b.id)}),a},savePageTabsOrder:function(){this.newOrder=this.getNewPageTabsOrder();if(JSON.stringify(this.newOrder)==JSON.stringify(this.oldOrder))return;App.Requester.request("pageOrder",{data:this.newOrder}),this.oldOrder=this.newOrder},regPageTabObservers:function(){if(!App.Permit.editPageTab)return;var a={tag:"li",only:"pTab",targeting:!0,overlap:"horizontal",constraint:"horizontal",ghosting:!0,onUpdate:this.savePageTabsOrder.bind(this)};Sortable.create(App.Framework.elm_navBar,a),this.regDrops(),this.oldOrder=this.getNewPageTabsOrder()},disRegPageTabObservers:function(){Sortable.destroy(App.Framework.elm_navBar)},drag_snap:function(a,b){var c=Math.max(0,Math.min(a,screen.availWidth)),d=Position.positionedOffset(App.Framework.elm_navBar),e=Math.max(d[1],Math.min(b,d[1]+App.Framework.elm_navBar.offsetHeight));return[c,e]},regDrops:function(){this.pTabs.each(function(a){a.regDrop()})},showModCtnInfo:function(a){if(!a.options.isActive)return;if(a.options.mods.flatten().length===0){App.Permit.editPageTab?App.Framework.elm_modCtnInfo.innerHTML=App.Lang.goAddModPageInfo:App.Framework.elm_modCtnInfo.innerHTML=App.Lang.noModPageInfo,App.Framework.elm_modCtnInfo.className="modCtnInfo-noMod clearfix",Element.show(App.Framework.elm_modCtnInfo);return}if(a.pl&&a.pl.info&&a.pl.info.length&&isMyBlog()){App.Framework.elm_modCtnInfo.innerHTML=a.pl.info,App.Framework.elm_modCtnInfo.className=a.options.permit!=0?"modCtnInfo-private clearfix":"modCtnInfo-private public clearfix",Element.show(App.Framework.elm_modCtnInfo);return}this.hideModCtnInfo()},hideModCtnInfo:function(){Element.hide(App.Framework.elm_modCtnInfo)},newPageTab:function(a){if(!a)return;if(this.pTabs.length>=App.maxPageTabCount){var b={type:"alert",title:App.Lang.error,content:App.Lang.tooManyPages},c=new PopWin(b);return}this.newPL=App.PageLib.getPage(a),this.newPW_all=[],this.newPW_okW=[],this.newPW_noW=[],this.newPW_noM=[],$A(this.newPL.widgets).each(function(a,b){this.newPW_all.push([]),this.newPW_okW.push([]),this.newPW_noW.push([]),a.each(function(a,c){var d=App.WidgetLib.getWidget(a);if(!d)throw $continue;if((d.only||d.sys)&&App.UserData.getModByType(a)){var e=App.UserData.getModByType(a);this.newPW_all[b].push(e.id),this.newPW_noW[b].push(a),this.newPW_noM.push(e.id)}else this.newPW_all[b].push(a),this.newPW_okW[b].push(a)}.bind(this))}.bind(this)),App.Permit.ableLog&&($LT("App.PageTabs.newPageTab\n"),$LR("newPW_all: "+JSON.stringify(this.newPW_all)),$LR("newPW_okW: "+JSON.stringify(this.newPW_okW)),$LR("newPW_noW: "+JSON.stringify(this.newPW_noW)),$LR("newPW_noM: "+JSON.stringify(this.newPW_noM)));if(this.newPW_noM.length>0){var d="";d+=App.Lang.beSboutToAddNewPage,d+="["+this.newPL.title+"], ",d+=App.Lang.itContaintMods+":\n",$A(this.newPL.widgets.flatten()).each(function(a,b){d+="["+App.WidgetLib.getWidget(a).title+"]",b<this.newPL.widgets.flatten().length-1&&(d+=", ")}.bind(this)),d+="\n\n",d+=App.Lang.hasUsingTheseMods+":\n",$A(this.newPW_noW.flatten()).each(function(a,b){d+="["+App.WidgetLib.getWidget(a).title+"]",b<this.newPW_noW.flatten().length-1&&(d+=", ")}.bind(this)),d+="\n\n",d+=App.Lang.whetherMoveMods;var b={type:"confirm",content:d,focus:!1,width:"350",okText:App.Lang.moveMod,okAction:this.reqNewPageTab.bind(this),okData:!0,cancelText:App.Lang.notMoveMod,cancelAction:this.reqNewPageTab.bind(this),cancelData:!1,closeAction:Prototype.emptyFunction},c=new PopWin(b)}else this.reqNewPageTab(!0)},reqNewPageTab:function(a){this.opt4newPageTab={type:this.newPL.type,title:this.newPL.title||App.Lang.aNewPage,ico:this.newPL.ico!=null?this.newPL.ico:0,colStyle:this.newPL.colStyle||App.defaultColStyle,permit:this.newPL.permit||0,widgets:this.newPW_all||[]},a?$A(this.newPW_noM).each(function(a){var b=App.Modules.getObjById(a);if(!b)throw $contunue;var c=b.options.page;b.destroy(),c.saveModsOrder("noToServer")}):this.opt4newPageTab.widgets=this.newPW_okW||[],App.Requester.request("newPage",{options:this.opt4newPageTab})},analyseNewPageTab:function(a){App.Permit.ableLog&&$LT("App.PageTabs.analyseNewPageTab");if(!a)return;var b=a.getElementsByTagName("mod");this.newPageData=null,$A(b).each(function(a){var b=App.UserData.getModData(a);b.type=="order"?(this.newPageData=b.data,App.UserData.userModulseOrder.data.push(b.data)):App.UserData.userModulesData.push(b)}.bind(this)),this.doNewPageTab()},doNewPageTab:function(){var a={};this.newPageData&&(a=this.newPageData[0]);var b=Object.extend(this.opt4newPageTab,a),c=new App.PageTab(b);this.regPageTabObservers(),c.active(),App.Framework.updateNewPageMenuContent(),this.newPL.ableSetTit&&c.editTitle()}},App.PageTab=Class.create(),App.PageTab.prototype={initialize:function(a){App.Permit.ableLog&&$LT("App.PageTab[id:"+a.id+"] initialize"),this.options=Object.extend({id:null,type:"0",ico:0,title:"",colStyle:null,mods:[],permit:0,isActive:!1,createMods:!1,placeIn:App.Framework.elm_navBar,sDivCss:"menuSub-div",imtDivCss:"subMenu-maintitle",itDivCss:"subMenu-title",isDivCss:"menuInnerSub-div",sOutCss:"menuSub-out",sOverCss:"menuSub-over",sDownCss:"menuSub-down",sDisableCss:"menuSub-disabled",sActiveCss:"menuSub-active"},a||{}),this.pl=App.PageLib.getPage(this.options.type),this.pl||(this.pl=App.PageLib.getPage("0")),!this.pl.ableSetTit&&this.pl.title&&(this.options.title=this.pl.title),!this.pl.ableSetCol&&this.pl.colStyle&&(this.options.colStyle=this.pl.colStyle),!this.pl.ableSetIco&&this.pl.ico&&(this.options.ico=this.pl.ico),this.pl.ableSetPer||(this.options.permit=this.pl.permit),this.build(),App.PageTabs.register(this),App.Permit.editPageTab&&this.regDrop(),this.buildModCtn(),this.options.createMods&&this.createMods()},destroy:function(){if(!this.element)return;this.disActive(),this.disRegDrop(),this.removeMods(),this.modCtn.destroy(),Element.remove(this.element),this.element=null,setTimeout(function(){App.PageTabs.unregister(this)}.bind(this),10)},build:function(){App.Permit.ableLog&&$LT("App.PageTab[id:"+this.options.id+"] build");var a=document.createElement("li");this.element=a,a.id=this.options.id,Element.addClassName(a,"pTab"),this.options.permit!=0&&Element.addClassName(a,"private"),this.options.isActive&&Element.addClassName(a,"active"),App.PageTabs.showModCtnInfo(this);var b=[];this.options.ico||(this.options.ico=0);var c=this.options.title?this.options.title.escapeHTML():"";b.push('<img class="pageIcon" src="'+(this.options.ico!=0?App.Actions.imgPath+App.Actions.icoShortPath+App.icoLib[this.options.ico]:App.Actions.imgPath+"spacer.gif")+'" alt="'+(this.options.ico?c:"")+'" />'),b.push('<span class="pageTitle"'+(this.options.isActive&&App.Permit.editPageTab&&this.pl.ableSetTit?' title="'+App.Lang.clk2chgPageName+'"':"")+">"+c+"</span>"),App.Permit.editPageTab&&(b.push('<img class="pageCls" src="'+App.Actions.imgPath+'spacer.gif" alt="'+App.Lang.delPage+'" title="'+App.Lang.delPage+'" />'),b.push('<img class="pageOpt" src="'+App.Actions.imgPath+'spacer.gif" alt="'+App.Lang.setPageOpt+'" title="'+App.Lang.setPageOpt+'" />')),a.innerHTML=b.join(""),b=null,this.eventCancelBubble=App.cancelBubble.bindAsEventListener(this),this.elm_ico=a.firstChild,this.elm_title=a.childNodes[1],a.childNodes[2]&&(this.elm_del=a.childNodes[2]),a.childNodes[3]&&(this.elm_opt=a.childNodes[3]),this.options.ico==0&&(this.elm_ico.style.width="1px"),!this.pl.ableDel&&this.elm_del&&(this.elm_del.style.visibility="hidden"),!this.pl.ableSetOpt&&this.elm_opt&&(this.elm_opt.style.visibility="hidden"),this.eventActive=function(){this.options.isActive||this.active()}.bindAsEventListener(this),Event.observe(this.element,"click",this.eventActive),App.Permit.editPageTab&&(this.pl.ableSetTit&&(Event.observe(this.elm_title,"mouseover",function(){this.options.isActive&&Element.addClassName(this.elm_title,"pageTitleHover")}.bind(this)),Event.observe(this.elm_title,"mouseout",function(){this.options.isActive&&Element.removeClassName(this.elm_title,"pageTitleHover")}.bind(this)),Event.observe(this.elm_title,"mousedown",this.eventCancelBubble),this.eventEditTitle=function(a){this.options.isActive&&(this.editTitle(),App.cancelBubble(a))}.bindAsEventListener(this),Event.observe(this.elm_title,"click",this.eventEditTitle)),Event.observe(this.elm_del,"mouseover",function(){this.options.isActive&&Element.addClassName(this.elm_del,"pageClsHover")}.bind(this)),Event.observe(this.elm_del,"mouseout",function(){this.options.isActive&&Element.removeClassName(this.elm_del,"pageClsHover")}.bind(this)),Event.observe(this.elm_del,"mousedown",this.eventCancelBubble),this.eventClose=this.close.bindAsEventListener(this),Event.observe(this.elm_del,"click",this.eventClose),Event.observe(this.elm_opt,"mouseover",function(){this.options.isActive&&Element.addClassName(this.elm_opt,"pageOptHover")}.bind(this)),Event.observe(this.elm_opt,"mouseout",function(){this.options.isActive&&Element.removeClassName(this.elm_opt,"pageOptHover")}.bind(this)),Event.observe(this.elm_opt,"mousedown",this.eventCancelBubble),this.eventSetOpt=this.setOpt.bindAsEventListener(this),Event.observe(this.elm_opt,"click",this.eventSetOpt),this.options.isActive||(Element.hide(this.elm_del),Element.hide(this.elm_opt)))},buildModCtn:function(){var a={colStyle:this.options.colStyle,isActive:this.options.isActive,placeIn:App.Framework.elm_modCtn};this.modCtn=new App.ModContainer(a),this.modCtn.pageTab=this},removeMods:function(){$A(App.Modules.modules).select(function(a){return a.options.page==this}.bind(this)).each(function(a){App.UserData.delMod(a.options),a.destroy()}),App.Framework.updateNewModMenuContent()},createMods:function(){this.loaded=!0,LoadBar.show(App.Lang.createAllModules);var a=100;$A(this.options.mods).each(function(a,b){$A(a).each(function(a,c){$A(App.UserData.userModulesData).each(function(d){if(d.id==a){var e={page:this,placeIn:this.modCtn.cols[b]?this.modCtn.cols[b]:this.modCtn.cols[this.modCtn.cols.length-1],fastLoad:c},f=Object.extend(d,e);if(this.options.permit==0&&App.WidgetLib.getWidget(f.type)&&App.WidgetLib.getWidget(f.type).private){if(App.Permit.editModule){var g=new App.Module(f,!0);setTimeout(function(){g.doClose()},0)}}else var g=new App.Module(f,!0);throw $break}}.bind(this))}.bind(this))}.bind(this)),LoadBar.hide(),setTimeout(this.regModObservers.bind(this),a),a+=100},getPageTabData:function(){var a={id:this.options.id,title:this.options.title,ico:this.options.ico,permit:this.options.permit,colStyle:this.options.colStyle,mods:this.getModsOrder()};return a},getModsOrder:function(){if(!this.loaded)return this.options.mods;var a=[],b=$A(this.modCtn.cols);return $A(b).each(function(b){var c=[];$A(b.childNodes).each(function(a){a.tagName&&a.tagName.toUpperCase()=="div".toUpperCase()&&Element.hasClassName(a,"mod")&&a.id&&c.push(a.id)}),a.push(c)}),a},saveModsOrder:function(a){this.newMods=this.getModsOrder();if(a!="doToServer"&&JSON.stringify(this.newMods)==JSON.stringify(this.options.mods))return;this.options.mods=this.newMods,a!="noToServer"&&App.Requester.request("editPageMods",this),App.PageTabs.showModCtnInfo(this)},regModObservers:function(){if(!App.Permit.sortable)return;var a={tag:"div",handle:"t",handleTag:"td",only:"mod",dropOnEmpty:!0,targeting:!0,containment:this.modCtn.cols,constraint:!1,snap:this.drag_snap,starteffect:function(a){Browser.ua.indexOf("ie")>=0?new Effect.Opacity(a,{duration:0,from:1,to:.7}):new Effect.Opacity(a,{duration:.2,from:1,to:.7});var b=$A(a.getElementsByTagName("object")),c=$A(a.getElementsByTagName("embed"));c=c.reject(function(a){return a.parentNode.tagName.toLowerCase()=="object"}),b=b.concat(c);var d=$A(a.getElementsByTagName("iframe")),e=b.concat(d);$A(e).each(function(a){var b=document.createElement("div");b.className="divFlashSpacer";var c=a.width||a.offsetWidth,d=a.height||a.offsetHeight;b.style.width=isNaN(c)?c:c+"px",b.style.height=isNaN(d)?d:d+"px",b.style.overflow="hidden",a.parentNode.insertBefore(b,a),Element.hide(a)})},endeffect:function(a){Browser.ua.indexOf("ie")>=0?new Effect.Opacity(a,{duration:0,from:.7,to:1}):new Effect.Opacity(a,{duration:.2,from:.7,to:1});var b=$A(a.getElementsByTagName("object")),c=$A(a.getElementsByTagName("embed"));c=c.reject(function(a){return a.parentNode.tagName.toLowerCase()=="object"}),b=b.concat(c);var d=$A(a.getElementsByTagName("iframe")),e=b.concat(d);$A(e).each(function(a){Element.show(a)}),$A(document.getElementsByClassName("divFlashSpacer",a,"div")).each(function(a){Element.remove(a)})}};$A(this.modCtn.cols).each(function(b){a=Object.extend(a,{onUpdate:this.saveModsOrder.bind(this)}),Sortable.create(b,a)}.bind(this))},disRegModObservers:function(){$A(this.modCtn.cols).each(function(a){Sortable.destroy(a)})},drag_snap:function(a,b){var c=Math.max(0,Math.min(a,screen.availWidth)),d=Math.max(30,b);return[c,d]},active:function(a){if(this.options.isActive)return;App.PageTabs.disActiveAll(),this.options.isActive=!0,Element.addClassName(this.element,"active"),App.PageTabs.showModCtnInfo(this),this.pl.ableSetTit&&App.Permit.editPageTab&&(this.elm_title.title=App.Lang.clk2chgPageName),this.elm_del&&this.elm_opt&&(Element.show(this.elm_del),Element.show(this.elm_opt)),this.modCtn.active(),this.loaded||this.createMods(),a||App.PageTabs.setHash(this),App.Framework.updateNewModMenuContent()},disActive:function(){if(!this.options.isActive)return;this.options.isActive=!1,Element.removeClassName(this.element,"active"),this.elm_title.title="",this.elm_del&&this.elm_opt&&(Element.hide(this.elm_del),Element.hide(this.elm_opt)),this.modCtn.disActive(),this.hideOptMenu(),this.saveTitle()},editTitle:function(){Element.hide(this.elm_ico),Element.hide(this.elm_title),Element.hide(this.elm_del),Element.hide(this.elm_opt);var a=document.createElement("input");this.elm_titleIpt=a,a.type="text",a.value=this.options.title,a.style.width=this.options.title.length*12+20+"px",this.element.appendChild(a),a.focus(),a.select(),Event.observe(a,"keydown",this.onTitleEnterDown.bindAsEventListener(this)),a.onkeyup=function(){this.style.width=this.value.length*12+20+"px"},Event.observe(a,"blur",this.saveTitle.bindAsEventListener(this)),this.editingTitle=!0},onTitleEnterDown:function(a){Browser.ua!="other"&&a.keyCode==13&&this.saveTitle()},saveTitle:function(){if(!this.editingTitle)return;this.editingTitle=!1;var a=this.elm_titleIpt.value;a=a.trim()==""?this.options.title:a.convertTextToHTML();if(a==this.options.title){this.endEditTitle();return}if(getTureLength(a)>12){var b=App.Lang.pageTitleTooLong+"("+getTureLength(a)+App.Lang.byte+")";b+="\n"+App.Lang.reduceTo+"12"+App.Lang.byte+"(6"+App.Lang.chsWord+")",b+="\n\n",b+=App.Lang.confirmToEdit,b+="\n",b+=App.Lang.cannelThisOperation,confirm(b)?(this.elm_titleIpt.focus(),this.elm_titleIpt.select(),this.editingTitle=!0):this.endEditTitle();return}this.newTitle=a,App.Requester.request("editPageTitle",this)},doSaveTitle:function(a){var b=this.newTitle;if(a&&Element.getChildValueByTagName(a,"data")[0]){var c=JSON.parse(Element.getChildValueByTagName(a,"data")[0])[0];c.title&&(b=c.title)}this.options.title=b,this.elm_title.innerHTML=b,this.elm_ico&&(this.elm_ico.alt=b),this.endEditTitle()},endEditTitle:function(){Element.remove(this.elm_titleIpt),Element.show(this.elm_ico),Element.show(this.elm_title),this.elm_del&&this.elm_opt&&(Element.show(this.elm_del),Element.show(this.elm_opt)),this.editingTitle=!1},hasNoDelMod:function(){var a=[];return $A(this.options.mods.flatten()).each(function(b){var c=App.Modules.getObjById(b);if(!c)throw $continue;var d=App.WidgetLib.getWidget(c.options.type);c&&d&&!d.ableDel&&a.push(c)}.bind(this)),a},close:function(){if(App.PageTabs.pTabs.length<=1){var a={type:"alert",title:App.Lang.error,content:App.Lang.cannotDelOnlyPage},b=new PopWin(a);return}var c=App.PageTabs.getPublicTabs();if(this.options.permit==0&&c.length<=1){var a={type:"alert",title:App.Lang.error,content:App.Lang.cannotDelOnlyPubPage},b=new PopWin(a);return}var d=this.hasNoDelMod();if(d.length>0){var e="";e+=App.Lang.hasNoDelMods,e+=":",d.each(function(a,b){b!=0&&(e+=","),e+="["+a.options.title+"]"}),e+="\n",e+="\n",e+=App.Lang.cannotDelNoDelModPage;var a={type:"alert",title:App.Lang.error,content:e},b=new PopWin(a);return}var a={type:"confirm",content:App.Lang.confirmDelPage,focus:!1,okAction:this.acceptClose.bind(this)},b=new PopWin(a)},acceptClose:function(){App.Requester.request("delPage",this)},doClose:function(){this.destroy()},getPermitOpt:function(){var a=document.createElement("div");a.className=this.options.isDivCss+" clearfix";var b=[];return b.push("<ul>"),b.push('<li><label for="pagePub_'+this.options.id+'">'),b.push('<input type="radio" id="pagePub_'+this.options.id+'" name="pagePermit_'+this.options.id+'" value="0"'+(this.options.permit==0?' checked="checked"':"")+" />"+App.Lang.pagePublic),b.push("</label></li>"),b.push('<li><label for="pagePri_'+this.options.id+'">'),b.push('<input type="radio" id="pagePri_'+this.options.id+'" name="pagePermit_'+this.options.id+'" value="1"'+(this.options.permit!=0?' checked="checked"':"")+" />"+App.Lang.pagePrivate),b.push("</label></li>"),b.push("</ul>"),a.innerHTML=b.join(""),this.optPub=a.firstChild.childNodes[0].firstChild.firstChild,this.optPri=a.firstChild.childNodes[1].firstChild.firstChild,Event.observe(this.optPub,"click",function(){this.setPermit(0),this.optMenu&&this.optMenu.hide()}.bind(this)),Event.observe(this.optPri,"click",function(){this.setPermit(1),this.optMenu&&this.optMenu.hide()}.bind(this)),a},getTitleOpt:function(){var a=document.createElement("div");a.className=this.options.isDivCss+" clearfix";var b=[];return b.push("<ul>"),b.push('<li><a href="javascript:void(0)">'+App.Lang.chgPageTitle+"</a></li>"),b.push("</ul>"),a.innerHTML=b.join(""),this.optSetTitle=a.firstChild,Event.observe(this.optSetTitle,"click",function(){this.editTitle(),this.optMenu&&this.optMenu.hide()}.bind(this)),a},setOpt:function(){if(!this.optMenu){var a={menuData:[],title:App.Lang.pageOpt,btn:this.element,zIndex:500,sDivCss:"menuSub-div menuSub-div-colStyle"};if(this.pl.ableSetCol){var b={title:App.Lang.pageLayout,active:!0,isDivCssEx:"menuInnerSub-div-colStyle",data:[]};$H(App.colStyleLib).each(function(a){b.data.push({text:'<img src="'+App.Actions.imgPath+a.value+'" alt="'+a.key+'" />',title:a.key,action:this.setColStyle.bind(this),value:a.key,active:this.options.colStyle==a.key})}.bind(this)),a.menuData.push(b)}this.pl.ableSetTit&&a.menuData.push({title:App.Lang.pageTitle,active:!1,data:this.getTitleOpt.bind(this)});if(this.pl.ableSetIco){var c={title:App.Lang.pageIcon,active:!1,isDivCssEx:"menuInnerSub-div-ico",data:[]};$A(App.icoLib).each(function(a,b){c.data.push({text:'<img src="'+App.Actions.imgPath+App.Actions.icoShortPath+a+'" alt="'+"["+b+"]:"+a+'" />',title:"["+b+"]:"+a,action:this.setIcon.bind(this),value:b,active:this.options.ico==b})}.bind(this)),a.menuData.push(c)}this.pl.ableSetPer&&a.menuData.push({title:App.Lang.pagePermit,active:!1,data:this.getPermitOpt.bind(this)}),this.optMenu=new WinMenu(a)}this.optMenu.win.showing?this.hideOptMenu():(App.PageTabs.hideOptMenuAll(),this.showOptMenu())},showOptMenu:function(){if(!this.optMenu)return;this.optMenu.show()},hideOptMenu:function(){if(!this.optMenu)return;this.optMenu.hide()},setColStyle:function(a){if(!a||a==this.options.colStyle)return;this.newColStyle=a,App.Requester.request("editPageColStyle",this)},doSetColStyle:function(a){var b=this.newColStyle;if(a&&Element.getChildValueByTagName(a,"data")[0]){var c=JSON.parse(Element.getChildValueByTagName(a,"data")[0])[0];c.colStyle&&(b=c.colStyle)}this.options.colStyle=b,this.modCtn.setColStyle(b)},setIcon:function(a){if(a==this.options.ico)return;this.newIco=a,App.Requester.request("editPageIco",this)},doSetIcon:function(a){var b=this.newIco;if(a&&Element.getChildValueByTagName(a,"data")[0]){var c=JSON.parse(Element.getChildValueByTagName(a,"data")[0])[0];c.ico&&(b=c.ico)}this.options.ico=b,this.options.ico==0?(this.elm_ico.src=App.Actions.imgPath+"spacer.gif",this.elm_ico.style.width="1px"):(this.elm_ico.src=App.Actions.imgPath+App.Actions.icoShortPath+App.icoLib[this.options.ico],this.elm_ico.style.width="16px")},hasPrivateMod:function(){var a=[];return $A(this.options.mods.flatten()).each(function(b){var c=App.Modules.getObjById(b);c&&App.WidgetLib.getWidget(c.options.type).private&&a.push(c)}.bind(this)),a},setPermit:function(a){if(a==this.options.permit)return;if(a==0){var b=this.hasPrivateMod();if(b.length>0){var c="";c+=App.Lang.hasPriveMods,c+=":",b.each(function(a,b){b!=0&&(c+=","),c+="["+a.options.title+"]"}),c+="\n",c+="\n",c+=App.Lang.cannotSetPublic;var d={type:"alert",title:App.Lang.error,content:c},e=new PopWin(d);this.optPub.checked=!1,this.optPri.checked=!0;return}}else{var f=App.PageTabs.getPrivateTabs();if(f.length==App.PageTabs.pTabs.length-1){var c="";c+=App.Lang.cannotAllPrivate;var d={type:"alert",title:App.Lang.error,content:c},e=new PopWin(d);this.optPub.checked=!0,this.optPri.checked=!1;return}}this.newPermit=a,App.Requester.request("editPagePermit",this)},doSetPermit:function(a){var b=this.newPermit;if(a&&Element.getChildValueByTagName(a,"data")[0]){var c=JSON.parse(Element.getChildValueByTagName(a,"data")[0])[0];c.permit&&(b=c.permit)}this.options.permit=b,this.options.permit==0?Element.removeClassName(this.element,"private"):Element.addClassName(this.element,"private"),App.PageTabs.showModCtnInfo(this),App.Framework.updateNewModMenuContent()},regDrop:function(){App.Permit.ableLog&&$LT("App.PageTab[id:"+this.options.id+"] regDrop");var a={accept:"mod",hoverclass:"hover",onHover:this.onHover.bind(this),onDrop:this.onDrop.bind(this)};Droppables.add(this.element,a)},disRegDrop:function(){Droppables.remove(this.element)},onHover:function(a,b){var c=App.Modules.getObjByElement(a.element);if(c.options.page.element==this.element){Sortable.target(a,a.element.parentNode),Sortable.targetMark();return}Sortable.untarget()},onDrop:function(a,b,c){var d=App.Modules.getObjByElement(a.element),e=d.options.page;if(e.element==this.element)return;if(App.WidgetLib.getWidget(d.options.type).private&&this.options.permit==0){var f="";f+=App.Lang.movePriMod2PubPage,f+="\n",f+=App.Lang.cannotMovePriMod2PubPage;var g={type:"alert",title:App.Lang.error,content:f},h=new PopWin(g);return}this.loaded?(d.options.page=this,this.modCtn.cols[0].insertBefore(a.element,this.modCtn.cols[0].firstChild),e.saveModsOrder(),this.saveModsOrder()):(d.destroy(!0),this.options.mods[0].unshift(d.options.id),this.saveModsOrder("doToServer"))}},App.ModContainers={mCtns:[],register:function(a){$(a.options.placeIn).appendChild(a.element),this.mCtns.push(a)},unregister:function(a){this.mCtns=this.mCtns.reject(function(b){return b==a})}},App.ModContainer=Class.create(),App.ModContainer.prototype={initialize:function(a,b){App.Permit.ableLog&&$LT("App.ModContainer.initialize"),this.options=Object.extend({colStyle:App.defaultColStyle,isActive:!1,placeIn:document.body},a||{}),this.cols=[],this.build(),App.ModContainers.register(this)},destroy:function(){if(!this.element)return;Element.remove(this.element),this.element=null,App.ModContainers.unregister(this)},build:function(){var a=document.createElement("table");this.element=a,a.id="modContainerTable",a.cellSpacing="0",a.cellPadding="0",this.options.isActive||Element.hide(a);var b=this.element.insertRow(0);this.content=b,this.doSetColStyle(!0)},setColStyle:function(a){a&&a!=App.colStyle&&(this.options.colStyle=a,this.doSetColStyle())},doSetColStyle:function(a){this.colsRate=this.options.colStyle.split(":");var b=this.cols,c=this.colsRate.length!=b.length,d=this.colsRate.length<b.length;$A(this.colsRate.length>b.length?this.colsRate:b).each(function(a,c){this.colsRate[c]&&!b[c]&&this.addCol(),b[c]&&!this.colsRate[c]&&this.delCol(),b[c]&&this.colsRate[c]&&(this.cols[c].style.width=(isNaN(this.colsRate[c])?100:this.colsRate[c])+"%")}.bind(this)),Browser.ua=="opera"&&(Element.hide(this.element),Element.show(this.element)),a||(this.pageTab.regModObservers(),d&&this.pageTab.saveModsOrder())},addCol:function(){var a=this.cols.length,b=document.createElement("td");b.className="col",b.id=App.colId_prefix+(a+1),this.content.appendChild(b),this.cols.push(b)},delCol:function(){var a=this.cols.length-1,b=this.cols[a];$A(b.childNodes).each(function(b){this.cols[a-1].appendChild(b)}.bind(this)),Element.remove(b),this.cols=this.cols.reject(function(a){return a==b})},active:function(){Element.show(this.element)},disActive:function(){Element.hide(this.element)}},window.onunload=function(){try{App.PageTabs.stopListenHash(),App.Modules.unregisterAll(),delete App,App=null}catch(a){}},App.Modules={modules:[],register:function(a,b){b||!a.options.placeBefore?$(a.options.placeIn).appendChild(a.element):$(a.options.placeBefore)&&$(a.options.placeIn).insertBefore(a.element,$(a.options.placeBefore));if(a.options.floating){a.element.style.position="absolute",a.element.style.left=a.options.floating[0]+"px",a.element.style.top=a.options.floating[1]+"px",a.element.style.width=a.options.floating[2]+"px";var c={defaultWidth:a.options.floating[2],defaultHeight:a.options.floating[3]};this.registerResizable(a,c)}this.modules.push(a);if(!b&&Browser.ua.indexOf("ie")<0)var d=new Effect.Highlight(a.element,{duration:.3,queue:"front"}),d=new Effect.Highlight(a.element,{duration:.5,queue:"end"}),d=new Effect.Highlight(a.element,{duration:1,queue:"end"})},unregister:function(a){this.unregisterResizable(a),this.modules=this.modules.reject(function(b){return b==a})},unregisterAll:function(){try{for(var a=0;a<this.modules.length;a++)this.modules[a].destroy(),delete this.modules[a],this.modules[a]=null}catch(b){}},showAll:function(){this.modules.each(function(a,b){a.swapShowHide(!0)})},hideAll:function(){this.modules.each(function(a){a.swapShowHide(!1)})},registerResizable:function(a,b){if(!a)return;if(a.resizeObj)return;var c=Object.extend({able:App.Permit.resize,addons:"modCon",snap:this.resize_snap,change:this.resize_change,update:function(a){App.Modules.getObjByElement(a.element).setFloat()}},b||{});a.resizeObj=new App.Resizable(a.element,c)},unregisterResizable:function(a){if(!a)return;a.resizeObj&&(a.resizeObj.destroy(),a.resizeObj=null)},resize_snap:function(a,b,c){var d=Math.max(180,Math.min(b,screen.availWidth)),e=Math.max(20,Math.min(c,screen.availHeight));return[d,e]},resize_change:function(a){var b=parseInt(Element.getStyle(a.element,"width")),c=parseInt(Element.getStyle(a.element,"height")),d=Math.max(180,Math.min(b,screen.availWidth)),e=Math.max(a.element.firstChild.offsetHeight,Math.min(c,screen.availHeight));a.element.style.width=d+"px",a.element.style.height=e+"px"},getObjByElement:function(a){return this.modules.find(function(b){return b.element==a})},getObjByType:function(a){return this.modules.find(function(b){return b.options.type==a})},getObjById:function(a){return this.modules.find(function(b){return b.options.id==a})},newOwMod:function(a){window.open(a,"_blank")},newMod:function(a){App.PageTabs.getActivePTab()?this.curPTab=App.PageTabs.getActivePTab():this.curPTab=App.PageTabs.pTabs[0];if(this.curPTab.options.mods.flatten().length>=App.maxPerPageModCount){var b={type:"alert",title:App.Lang.info,content:App.Lang.tooManyModsInOnePage},c=new PopWin(b);return}this.opt4newMod={type:a,title:""},App.Requester.request("new",{options:this.opt4newMod})},doNewMod:function(a){if(!a)return;var b=a.getElementsByTagName("mod")[0],c={page:this.curPTab||App.PageTabs.pTabs[0],id:b.getAttribute("id")||"",type:b.getAttribute("type")||this.opt4newMod.type||"",title:Element.getChildValueByTagName(b,"title")[0]||this.opt4newMod.title||"",data:Element.getChildValueByTagName(b,"data")[0]?JSON.parse(Element.getChildValueByTagName(b,"data")[0]):this.opt4newMod.data||"",placeIn:this.curPTab.modCtn.cols[0],placeBefore:this.curPTab.modCtn.cols[0].firstChild},d=new App.Module(c);setTimeout(function(){this.curPTab.regModObservers(),this.curPTab.saveModsOrder(),App.Framework.updateNewModMenuContent()}.bind(this),100)}},App.Module=Class.create(),App.Module.prototype={initialize:function(a,b){this.options=Object.extend({id:null,type:null,isExpanded:!0,share:!0,floating:!1,title:"",data:null,page:null,placeIn:document.body,placeBefore:null,newMode:!1},a||{}),Object.extend(this.options,{editMode:!1,loaded:!1,loadTime:0,maxLoadTime:App.maxWidgetLoadTime}),this.build(),this.m_content=this.getModuleContent(),this.m_suffix=this.getModuleSuffix(),App.Permit.editModule&&(this.m_edit=this.getEditContent(),this.hideEditMode()),this.setIco(),this.options.isExpanded?"":this.swapShowHide(!1,b),this.hideExpandBtn(),App.Modules.register(this,b),b?this.waitToAttachContent():(App.UserData.addMod(this.options),this.attachContent())},destroy:function(a){if(this.content&&this.content.destroy)try{this.content.destroy(),this.content=null}catch(b){}Element.remove(this.element),a?(this.options.page.saveModsOrder(),App.Framework.updateNewModMenuContent()):this.options.page.saveModsOrder("noToServer"),App.Modules.unregister(this)},build:function(a){var b=document.createElement("div");this.element=b,b.className="mod",b.id=this.options.id;var c=[];c.push('<div class="modFrame">'),c.push('<table cellspacing="0" cellpadding="0" class="modTable">'),c.push("<thead><tr>"),c.push('<td class="mheader lt"></td>'),c.push('<td class="mheader t"><div class="modHeader clearfix"></div></td>'),c.push('<td class="mheader rt"></td>'),c.push("</tr></thead>"),c.push("<tbody>"),App.Permit.editModule?c.push("<tr>"):c.push('<tr style="display:none;">'),c.push('<td class="mneck l"></td>'),c.push('<td class="mneck ec"><div class="modEditCon"></div></td>'),c.push('<td class="mneck r"></td>'),c.push("</tr>"),c.push("<tr>"),c.push('<td class="mbody l"></td>'),c.push('<td class="mbody c"><div class="modCon">'+App.Lang.loading+"</div>"),c.push('<div class="modSuffix" style="text-align:right;display:none;"><hr /><a href="javascript:void(0);" onmousedown="CA.a(\'widget_share_\' + (isPPLogin() ? (isMyBlog() ? \'admin\' : \'blogger\') : \'guest\'))"><img align="absmiddle" src="http://js2.pp.sohu.com.cn/ppp/images/icons/ico_share.gif" />推荐给好友</a></div></td>'),c.push('<td class="mbody r"></td>'),c.push("</tr></tbody>"),c.push("<tfoot><tr>"),c.push('<td class="mfooter lb"></td>'),c.push('<td class="mfooter b"></td>'),c.push('<td class="mfooter rb"></td>'),c.push("</tr></tfoot>"),c.push("</table>"),c.push("</div>"),b.innerHTML=c.join(""),c=null,this.eventCancelBubble=App.cancelBubble.bindAsEventListener(this);var d=this.getModTable().firstChild.firstChild.childNodes[1].firstChild;if(!this.options.newMode){var e=document.createElement("div");this.elm_showHide=e,e.className="modShow",e.title=App.Lang.showHideModuleBtnTitle,Event.observe(e,"mousedown",this.eventCancelBubble),this.eventSwapShowHide=this.swapShowHide.bindAsEventListener(this),Event.observe(e,"click",this.eventSwapShowHide),d.appendChild(e)}if(App.Permit.editModule){if(!this.options.newMode){var f=document.createElement("div");this.elm_close=f,f.className="modCls";var g="";App.WidgetLib.getWidget(this.options.type)&&App.WidgetLib.getWidget(this.options.type).sys?g=App.Lang.hideModuleBtnTitle:g=App.Lang.delModuleBtnTitle,f.title=g,Event.observe(f,"mousedown",this.eventCancelBubble),this.eventClose=this.close.bindAsEventListener(this),Event.observe(f,"click",this.eventClose),d.appendChild(f),Element.hide(f)}var h=document.createElement("div");this.elm_edit=h,h.className="modEdit",h.innerHTML='<a href="javascript:void(0)">'+App.Lang.setBtn+"</a>",Event.observe(h,"mousedown",this.eventCancelBubble),this.eventSwapEdit=this.swapEditMode.bindAsEventListener(this),Event.observe(h,"click",this.eventSwapEdit),d.appendChild(h),Element.hide(h)}if(!this.options.newMode){var i=document.createElement("div");this.elm_refresh=i,i.className="modRfs",i.title=App.Lang.refreshModuleBtnTitle,Event.observe(i,"mousedown",this.eventCancelBubble),this.eventRefresh=this.refresh.bindAsEventListener(this),Event.observe(i,"click",this.eventRefresh),d.appendChild(i),Element.hide(i)}if(!this.options.editModule){var j=document.createElement("div");this.elm_addMe=j,j.className="modAdw",j.innerHTML='<a href="javascript:void(0)">'+App.Lang.addMeModuleBtnTitle+"</a>",Event.observe(j,"mousedown",this.eventCancelBubble),this.eventAddMe=this.addMe.bindAsEventListener(this),Event.observe(j,"click",this.eventAddMe),d.appendChild(j),Element.hide(j)}var k=document.createElement("div");this.elm_ico=k,k.className="modIco",k.innerHTML='<img src="'+App.Actions.imgPath+'spacer.gif" />',d.appendChild(k);var l=document.createElement("div");this.elm_title=l,l.className="modTitle",l.innerHTML=this.options.title||App.Lang.createModule,d.appendChild(l),this.eventMouseOver=this.mouseOver.bind(this),this.eventMouseOut=this.mouseOut.bind(this),Event.observe(this.element,"mouseover",this.eventMouseOver),Event.observe(this.element,"mouseout",this.eventMouseOut)},mouseOver:function(){this.showBtns()},mouseOut:function(){this.hideBtns()},getModTable:function(){return this.element.firstChild.firstChild},getEditPanel:function(){var a=this.getModTable(),b=a.childNodes[1].firstChild;return b},getContentPanel:function(){var a=this.getModTable(),b=a.childNodes[1].childNodes[1];return b},getEditContent:function(){var a=this.getEditPanel(),b=a.childNodes[1].firstChild;return b},getModuleContent:function(){var a=this.getContentPanel(),b=a.childNodes[1].firstChild;return b},getModuleSuffix:function(){var a=this.getContentPanel(),b=a.childNodes[1].lastChild;return b},setIco:function(a){if(!a){Element.hide(this.elm_ico);return}var b=this.elm_ico.firstChild;b.src=a,b.onload=function(){this.height>16&&(this.height="16")},Element.show(this.elm_ico)},showIcoBtn:function(){this.elm_ico&&Element.show(this.elm_ico)},hideIcoBtn:function(){this.elm_ico&&Element.hide(this.elm_ico)},setTitle:function(a,b){if(!a)return;if(this.options.title&&!b)return;this.elm_title.innerHTML=a},getTitle:function(){return this.elm_title.innerHTML},setFloat:function(){this.options.floating=[parseInt(Element.getStyle(this.element,"left")),parseInt(Element.getStyle(this.element,"top")),parseInt(Element.getStyle(this.element,"width")),parseInt(Element.getStyle(this.element,"height"))],App.Requester.request("float",this)},showRefreshBtn:function(){this.elm_refresh&&Element.show(this.elm_refresh)},hideRefreshBtn:function(){this.elm_refresh&&Element.hide(this.elm_refresh)},refresh:function(a){this.content&&this.content.refresh&&this.options.loaded&&(this.options.loaded=!1,this.content.refresh())},loaded:function(){this.options.loaded=!0},showCloseBtn:function(){Element.show(this.elm_close)},hideCloseBtn:function(){this.elm_close&&Element.hide(this.elm_close)},close:function(){var a={type:"confirm",content:App.WidgetLib.getWidget(this.options.type)&&App.WidgetLib.getWidget(this.options.type).sys?App.Lang.confirmHideModule:App.Lang.confirmDelModule,focus:!1,okAction:this.acceptClose.bind(this)},b=new PopWin(a)},acceptClose:function(){App.Requester.request("del",this)},doClose:function(){App.UserData.delMod(this.options),this.destroy(!0)},showAddMeBtn:function(){this.elm_addMe&&Element.show(this.elm_addMe)},hideAddMeBtn:function(){this.elm_addMe&&Element.hide(this.elm_addMe)},addMe:function(){if(!(this.content&&this.content.addMe&&this.content.addMe())){var a="&type="+this.options.type;if(this.options.data.oid){var b=[],c=Object.keys(this.options.data);for(var d=0;d<c.length;d++)b.push(c[d]+"="+escape(this.options.data[c[d]]));a+="&oid="+this.options.data.oid+"&"+b.join("&")}window.open("http://blog.sohu.com/manage/module.do?m=preview"+a)}},swapShowHide:function(a,b){this.lastIsExpanded=this.options.isExpanded,typeof arguments[0]=="boolean"?arguments[0]?this.show():this.hide():this.options.isExpanded?this.hide():this.show(),App.Permit.editModule&&!b&&(typeof a=="undefined"||a!=this.lastIsExpanded)&&App.Requester.request("expand",this)},showExpandBtn:function(){this.elm_showHide&&Element.show(this.elm_showHide)},hideExpandBtn:function(){this.elm_showHide&&Element.hide(this.elm_showHide)},show:function(a){Element.show(this.getContentPanel()),this.resizeObj&&(Browser.ua=="opera"?setTimeout(function(){this.resizeObj.adjustSize(!1,!0)}.bind(this),10):this.resizeObj.adjustSize(!1,!0),this.resizeObj.options.constraint=this.resizeObj.defaultConstraint),Element.hasClassName(this.elm_showHide,"modHide")&&Element.removeClassName(this.elm_showHide,"modHide"),Element.addClassName(this.elm_showHide,"modShow"),a||(this.options.isExpanded=!0)},hide:function(a){Element.hide(this.getContentPanel()),this.resizeObj&&(Browser.ua=="opera"?setTimeout(function(){this.resizeObj.adjustSize(!1,!0)}.bind(this),10):this.resizeObj.adjustSize(!1,!0),this.resizeObj.defaultConstraint=this.resizeObj.options.constraint,this.resizeObj.options.constraint="horizontal"),Element.hasClassName(this.elm_showHide,"modShow")&&Element.removeClassName(this.elm_showHide,"modShow"),Element.addClassName(this.elm_showHide,"modHide"),a||(this.options.isExpanded=!1)},showEditBtn:function(){Element.show(this.elm_edit)},hideEditBtn:function(){this.elm_edit&&Element.hide(this.elm_edit)},swapEditMode:function(){this.options.editMode?this.closeEdit():this.edit()},edit:function(a){this.options.editMode=!0,this.content&&this.content.edit&&this.content.edit(),this.showEditMode(),this.show()},closeEdit:function(a){this.options.editMode=!1,this.content&&this.content.onCloseEdit&&this.content.onCloseEdit(),this.hideEditMode()},save:function(a,b){if(!a&&b===null)return;typeof a!="undefined"&&a&&(this.options.data=a),typeof b!="undefined"&&b!==null&&(this.options.title=b),App.Requester.request("edit",this)},endSave:function(){this.content&&this.content.endSave&&this.content.endSave(),this.closeEdit()},showEditMode:function(){var a=this.getEditPanel();Element.show(a),this.resizeObj&&(Browser.ua=="opera"?setTimeout(function(){this.resizeObj.adjustSize(!1,!0)}.bind(this),10):this.resizeObj.adjustSize(!1,!0)),this.setCloseEditBtn()},hideEditMode:function(){var a=this.getEditPanel();Element.hide(a),this.resizeObj&&(Browser.ua=="opera"?setTimeout(function(){this.resizeObj.adjustSize(!1,!0)}.bind(this),10):this.resizeObj.adjustSize(!1,!0)),this.setEditBtn()},setEditBtn:function(){this.elm_edit.firstChild.innerHTML=App.Lang.setBtn},setCloseEditBtn:function(){this.elm_edit.firstChild.innerHTML=App.Lang.closeSetBtn},waitToAttachContent:function(){if(Browser.ua.indexOf("ie")>=0&&!this.options.newMode)if(this.options.page.loaded){if(this.options.fastLoad==0)var a=Math.round(500*Math.random());else if(this.options.fastLoad==1)var a=Math.round(1e3*Math.random()+500);else var a=Math.round(2e3*Math.random()+1500);setTimeout(this.attachContent.bind(this),a)}else setTimeout(this.waitToAttachContent.bind(this),100);else this.attachContent()},attachContent:function(){if(!App.WidgetLib.getWidget(this.options.type)){this.showWidgetError();return}this.showWidgetLoading();if(App.Widgets[this.options.type])this.initWidget();else{var a=new App.Widget(this.options.type);this.waitForAttachContent()}},waitForAttachContent:function(){!!App.Widgets.hasRegistered(this.options.type),App.Widgets[this.options.type]?this.initWidget():this.options.loadTime<this.options.maxLoadTime?(this.options.loadTime+=100,setTimeout(this.waitForAttachContent.bind(this),100)):(App.Widgets.unregister(this.options.type),this.showWidgetInfo())},initWidget:function(){var a=App.WidgetLib.getWidget(this.options.type);this.setWidgetData(a),this.w_path=a.path,this.content=new App.Widgets[this.options.type](this.options.data,this.m_content,this.m_edit,this.w_path),this.content.id=this.options.id,this.content.setIco=this.setIco.bind(this),this.content.setTitle=this.setTitle.bind(this),this.content.getTitle=this.getTitle.bind(this),this.content.resetControls=this.resetControls.bind(this),this.resetControls(),this.content.initialize()},resetControls:function(){App.Permit.editModule&&typeof this.content.edit=="function"&&(this.content.save=this.save.bind(this),this.content.closeEdit=this.closeEdit.bind(this)),typeof this.content.refresh=="function"&&(this.content.loaded=this.loaded.bind(this)),typeof this.content.shareMePath=="function"&&this.content.shareMePath()&&(this.shareMeEl||(this.shareMeEl=this.m_suffix.lastChild),this.shareMeEvent||(this.shareMeEvent=this.shareMe.bind(this),Event.observe(this.shareMeEl,"click",this.shareMeEvent)),Element.show(this.m_suffix))},shareMe:function(e){var ele=this.shareMeEl,attr="data-share2";if(!isLogin()){ele.href=loginPath();return}if(ele.getAttribute(attr))return;ele.setAttribute(attr,"true"),ele.innerHTML='<img align="absmiddle" src="http://js2.pp.sohu.com.cn/ppp/images/icons/ico_share.gif" />正在推荐...';var func=function(req){var info=App.Lang.unknownError;if(req&&req.responseText)try{var json=eval("("+req.responseText+")");json&&json.statusText&&(info=json.statusText)}catch(e){}var aa=new PopWin({type:"alert",title:"推荐给好友",content:info});ele.innerHTML='<img align="absmiddle" src="http://js2.pp.sohu.com.cn/ppp/images/icons/ico_share.gif" />推荐给好友',ele.removeAttribute(attr)},path=this.content.shareMePath?this.content.shareMePath():this.shareMePath(),url="/py?url="+encodeURIComponent("http://ow.blog.sohu.com/widget/0/sendMsg?"+path+"&c="+timeStamp());new Ajax.Request(url,{method:"POST",onComplete:func})},shareMePath:function(){return"url="+this.options.type},showBtns:function(){App.Permit.editModule?this.content&&typeof this.content.edit=="function"&&this.showEditBtn():this.showAddMeBtn(),this.content&&typeof this.content.refresh=="function"&&(this.options.newMode||this.showRefreshBtn()),App.Permit.editModule&&!this.options.newMode&&this.showCloseBtn(),this.options.newMode||(this.hideIcoBtn(),this.showExpandBtn())},hideBtns:function(){this.hideEditBtn(),this.hideAddMeBtn(),this.hideRefreshBtn(),this.hideCloseBtn(),this.hideExpandBtn(),this.showIcoBtn()},showWidgetLoading:function(){var a="";a+=App.Lang.loadWidget,this.m_content.innerHTML=a},showWidgetError:function(){var a="";a+=App.Lang.widgetError,this.m_content.innerHTML=a},setWidgetData:function(a){this.options.title||this.setTitle(a.title||""),!this.options.ico&&a.ico?this.setIco(a.ico):this.setIco(),Element.addClassName(this.m_content,this.options.type+"-content"),Element.addClassName(this.m_edit,this.options.type+"-edit"),this.m_content.innerHTML=""},showWidgetInfo:function(){var a="";a+=App.Lang.loadTimeout,a+=App.Lang.reloadPage,a+="<br /><br />"+App.Lang.loadWidgetTimeout+"["+this.options.type+"]",this.m_content.innerHTML=a}},App.Widgets={registered:[],register:function(a){if(this.hasRegistered(a.type))return;this.registered.push(a)},hasRegistered:function(a){return this.registered.find(function(b){return b.type==a})?!0:!1},unregister:function(a){this.registered=this.registered.reject(function(b){return b.type==a})},getWidget:function(a){return this.registered.find(function(b){return b.type==a})}},App.Widget=Class.create(),App.Widget.prototype={initialize:function(a){var b;if(!(b=App.WidgetLib.getWidget(a)))return!1;if(App.Widgets.hasRegistered(a))return;Object.extend(this,b),this.analyse(),App.Widgets.register(this)},analyse:function(a){var b=this.path,c=this.ico.trim();c&&c.indexOf("http://")!==0&&c.indexOf("/")!==0&&(c=b+(c||"")),this.ico=c,$A(this.js).each(function(a,c){a.indexOf("http://")!==0&&a.indexOf("/")!==0&&(this.js[c]=b+a)}.bind(this)),$A(this.css).each(function(a,c){a.indexOf("http://")!==0&&a.indexOf("/")!==0&&(this.css[c]=b+a)}.bind(this)),this.loadLib()},loadLib:function(){$A(this.css).each(function(a){var b=new LinkFile(a,{type:"css"})}),$A(this.js).each(function(a){Browser.ua=="opera"?setTimeout(function(){var b=new LinkFile(a,{type:"script"})},100):new LinkFile(a,{type:"script"})})}},App.Themes={setTheme:function(a){if(!a)return;if(a==App.theme)return;var b=App.ThemeLib.getTheme(a);b||(b={},b.id=a),App.Requester.request("theme",b.code||b.id),App.theme=a},setOT:function(a){window.open(a,"_blank")},doSetTheme:function(a){if(a&&typeof a=="string")var b=a;else{var c=App.ThemeLib.getTheme(App.theme);!c&&App.theme.indexOf("g")==0&&(c={id:App.theme});var b=App.Actions.themePath+(c.path||c.id)+"/style.css"}$("themeCss")?($("themeCss").href=b,$("themeCss").setAttribute("themeid",App.theme)):(this.element=new LinkFile(b,{type:"css"}),this.element._link.id="themeCss",this.element._link.setAttribute("themeid",App.theme)),$("openTheme")&&Element.remove("openTheme")},doSetThemeGW:function(a){if(a&&typeof a=="string")var b=App.Actions.themePath+a+"/style.css";$("themeCss")?$("themeCss").href=b:(this.element=new LinkFile(b,{type:"css"}),this.element._link.id="themeCss"),$("openTheme")&&Element.remove("openTheme")}},App.UserStyle={stylesTempl:{"#header":{backgroundImage:"",backgroundRepeat:"",backgroundPosition:"",height:""},"#header-bak":{backgroundImage:""},body:{backgroundImage:"",backgroundRepeat:"",backgroundPosition:""},"body-bak":{backgroundImage:""}},styles:null,customTheme:function(){if(!this.cusThemeWin){var a={menuData:[{title:App.Lang.customHeader,active:!0,data:this.getCusHeaderCon.bind(this)},{title:App.Lang.customBodyBg,active:!1,data:this.getCusBodyBgCon.bind(this)}],elm_extendBottom:this.getCusThemeClean(),title:App.Lang.customTheme,dragable:!0,btn:App.Framework.elm_themeBtn,displace:[-495,0],zIndex:1e3,okBtn:!0,cancelBtn:!0,menuType:"tab",onOk:this.save.bind(this),onCancel:this.cancel.bind(this),sDivCss:"menuSub-div menuSub-div-cusTheme"};this.cusThemeWin=new WinMenu(a)}this.cusThemeWin.showing?this.cusThemeWin.hide():(this.cusThemeWin&&this.cusThemeWin.showing&&this.cusThemeWin.hide(),this.cusThemeWin.show())},getCusThemeInfo:function(){var a=document.createElement("div");return a.className="infoBox",a.innerHTML=App.Lang.customThemeInfo,a},getCusThemeClean:function(){var a=document.createElement("div");return a.className="cusThemeClean",a.innerHTML='<a href="javascript:void(0)">'+App.Lang.customThemeClean+"</a>",Event.observe(a.firstChild,"click",function(){var a={type:"confirm",content:App.Lang.confirmCleanCustomTheme,focus:!1,okAction:this.clean.bind(this)},b=new PopWin(a)}.bind(this)),a},getCusHeaderCon:function(){var a=document.createElement("div");a.className="menuInnerSub-div clearfix";var b=[];b.push("<fieldset>"),b.push("<legend>"+App.Lang.selectImage+"</legend>"),b.push('<div id="cusThemeHeaderBgiBox" style="padding:0;margin:5px;border:1px solid #ccc;height:128px;overflow-y:scroll;" class="clearfix">'),b.push('<div class="headerBgiSmp">'),b.push('<img src="'+App.Actions.imgPath+'custom/themesHeaderBg/default.gif" alt="'+App.Lang.useThemeDefaultHeaderImg+'" value="default" />'),b.push("</div>"),b.push('<div class="headerBgiSmp">'),b.push('<img src="'+App.Actions.imgPath+'custom/themesHeaderBg/upload.gif" alt="'+App.Lang.useMyHeaderImg+'" value="upload" />'),b.push("</div>"),b.push('<div class="headerBgiSmp">'),b.push('<img src="'+App.Actions.imgPath+'custom/themesHeaderBg/none.gif" alt="'+App.Lang.hideHeaderImg+'" value="none" />'),b.push("</div>"),App.CusThemeLib.headerBgi.lib.each(function(a){b.push('<div class="headerBgiSmp">'),b.push('<img src="'+(a.smp||a.src)+'" alt="'+a.src+'" value="'+a.src+'" />'),b.push("</div>")}.bind(this)),b.push("</div>"),b.push('<iframe src="/htmlarea/popups/insert_cusTheme.html?mode=headbgi&d='+_blog_domain+'" frameborder="0" style="margin-left:5px;display:none"></iframe>'),b.push('<input name="ct_header_bgi_bak" type="hidden" />'),b.push("</fieldset>"),b.push("<fieldset>"),b.push("<legend>"+App.Lang.imageOption+"</legend>"),b.push('<table width="100%">'),b.push("<tr>"),b.push('<td width="35">'+App.Lang.tiled+":</td>"),b.push("<td>"),b.push('<select name="ct_header_bgr" class="text">'),b.push('<option value="">'+App.Lang.def+"</option>"),b.push('<option value="repeat">'+App.Lang.repeat+"</option>"),b.push('<option value="no-repeat">'+App.Lang.noRepeat+"</option>"),b.push('<option value="repeat-x">'+App.Lang.repeatX+"</option>"),b.push('<option value="repeat-y">'+App.Lang.repeatY+"</option>"),b.push("</select>"),b.push("</td>"),b.push("</tr>"),b.push("<tr>"),b.push("<td>"+App.Lang.align+":</td>"),b.push("<td>"+App.Lang.horizontal+' <select name="ct_header_bgp_x" class="text">'),b.push('<option value="">'+App.Lang.def+"</option>"),b.push('<option value="left">'+App.Lang.left+"</option>"),b.push('<option value="center">'+App.Lang.center+"</option>"),b.push('<option value="right">'+App.Lang.right+"</option>"),b.push("</select>"),b.push("&nbsp;&nbsp;&nbsp;&nbsp;"+App.Lang.vertical+' <select name="ct_header_bgp_y" class="text">'),b.push('<option value="">'+App.Lang.def+"</option>"),b.push('<option value="top">'+App.Lang.top+"</option>"),b.push('<option value="center">'+App.Lang.middle+"</option>"),b.push('<option value="bottom">'+App.Lang.bottom+"</option>"),b.push("</select></td>"),b.push("</tr>"),b.push("<tr>"),b.push("<td>"+App.Lang.height+":</td>"),b.push('<td><input name="ct_header_h" type="text" class="text" maxlength="3" size="3" /><span>'+App.Lang.pixel+App.Lang.customHeaderHeightInfo+"</span></td>"),b.push("</tr>"),b.push("</table>"),b.push("</fieldset>"),a.innerHTML=b.join("");var c=$A(a.getElementsByTagName("input"));return c=c.concat($A(a.getElementsByTagName("select"))),$A(c).each(function(a){a.name=="ct_header_bgi_bak"&&(this.ipt_header_bgi_bak=a),a.name=="ct_header_bgr"&&(this.ipt_header_bgr=a),a.name=="ct_header_bgp_x"&&(this.ipt_header_bgp_x=a),a.name=="ct_header_bgp_y"&&(this.ipt_header_bgp_y=a),a.name=="ct_header_h"&&(this.ipt_header_h=a)}.bind(this)),this.ifm_header_bgi_up=a.getElementsByTagName("iframe")[0],this.elm_header_bgis=document.getElementsByClassName("headerBgiSmp",a,"div"),setTimeout(function(){this.updateCusHeaderData(),this.observeCusHeader()}.bind(this),1),a},updateCusHeaderData:function(){this.getStyle("header_bgi")&&this.getStyle("header_bgi")=="transparent"?this.activeOneHeaderBgi("none"):this.getStyle("header_bgi")!=""?App.CusThemeLib.headerBgi.getImg(this.getStyle("header_bgi"))?this.activeOneHeaderBgi(this.getStyle("header_bgi")):this.activeOneHeaderBgi("upload"):this.activeOneHeaderBgi("default"),this.ipt_header_bgi_bak.value=this.getStyle("header_bak_bgi"),this.ipt_header_bgr.value=this.getStyle("header_bgr"),this.ipt_header_bgp_x.value=this.getStyle("header_bgp_x"),this.ipt_header_bgp_y.value=this.getStyle("header_bgp_y"),this.ipt_header_h.value=this.getStyle("header_h")},activeOneHeaderBgi:function(a){$A(this.elm_header_bgis).each(function(b){b.firstChild.getAttribute("value")==a?(Element.addClassName(b,"headerBgiSmp-active"),b.style.display=="none"&&Element.show(b)):Element.removeClassName(b,"headerBgiSmp-active")})},observeCusHeader:function(){$A(this.elm_header_bgis).each(function(a){Event.observe(a,"mouseover",function(){Element.addClassName(a,"headerBgiSmp-over")}.bind(this)),Event.observe(a,"mouseout",function(){Element.removeClassName(a,"headerBgiSmp-over")}.bind(this)),Event.observe(a,"click",function(){var b=a.firstChild.getAttribute("value");this.activeOneHeaderBgi(b),Element.hide(this.ifm_header_bgi_up),b=="default"?(this.setCss("#header","background-image",""),this.ipt_header_bgr.value&&(this.ipt_header_bgr.value="",this.setCss("#header","background-repeat","")),this.ipt_header_h.value&&(this.ipt_header_h.value="",this.setCss("#header","height",""))):b=="none"?this.setCss("#header","background-image","none"):b=="upload"?(Element.show(this.ifm_header_bgi_up),$F(this.ipt_header_bgi_bak)&&this.setCss("#header","background-image","url("+$F(this.ipt_header_bgi_bak)+")")):(this.setCss("#header","background-image","url("+b+")"),(_tiled=App.CusThemeLib.headerBgi.getImg(b).tiled)&&this.ipt_header_bgr.value!=_tiled&&(this.ipt_header_bgr.value=_tiled,this.setCss("#header","background-repeat",_tiled)),(_height=App.CusThemeLib.headerBgi.getImg(b).height)&&this.ipt_header_h.value!=_height&&(this.ipt_header_h.value=_height,this.setCss("#header","height",_height+"px")))}.bind(this))}.bind(this)),Event.observe(this.ipt_header_bgr,"change",function(){this.setCss("#header","background-repeat",this.ipt_header_bgr.value)}.bind(this)),Event.observe(this.ipt_header_bgp_x,"change",function(){var a="";if(this.ipt_header_bgp_x.value||this.ipt_header_bgp_y.value)a=(this.ipt_header_bgp_x.value||"left")+" "+(this.ipt_header_bgp_y.value||"top");this.setCss("#header","background-position",a)}.bind(this)),Event.observe(this.ipt_header_bgp_y,"change",function(){var a="";if(this.ipt_header_bgp_x.value||this.ipt_header_bgp_y.value)a=(this.ipt_header_bgp_x.value||"left")+" "+(this.ipt_header_bgp_y.value||"top");this.setCss("#header","background-position",a)}.bind(this)),Event.observe(this.ipt_header_h,"keyup",function(){var a=this.ipt_header_h.value;this.ipt_header_h.nextSibling.style.color="#000000";if(a&&(isNaN(a)||a<100||a>500)){this.ipt_header_h.nextSibling.style.color="#FF0000",this.ipt_header_h.focus();return}this.setCss("#header","height",this.ipt_header_h.value+"px")}.bind(this)),Event.observe(this.ipt_header_h,"blur",function(){var a=this.ipt_header_h.value;if(a&&(isNaN(a)||a<100||a>500)){alert(App.Lang.customHeaderHeightError),this.ipt_header_h.focus();return}}.bind(this))},getCusBodyBgCon:function(){var a=document.createElement("div");a.className="menuInnerSub-div clearfix";var b=[];b.push("<fieldset>"),b.push("<legend>"+App.Lang.selectImage+"</legend>"),b.push('<div id="cusThemeBodyBgiBox" style="padding:0;margin:5px;border:1px solid #ccc;height:128px;overflow-y:scroll;" class="clearfix">'),b.push('<div class="bodyBgiSmp">'),b.push('<img src="'+App.Actions.imgPath+'custom/themesBodyBg/default.gif" alt="'+App.Lang.useThemeDefaultBodyImg+'" value="default" />'),b.push("</div>"),b.push('<div class="bodyBgiSmp">'),b.push('<img src="'+App.Actions.imgPath+'custom/themesBodyBg/upload.gif" alt="'+App.Lang.useMyBodyImg+'" value="upload" />'),b.push("</div>"),b.push('<div class="bodyBgiSmp">'),b.push('<img src="'+App.Actions.imgPath+'custom/themesBodyBg/none.gif" alt="'+App.Lang.hideBodyImg+'" value="none" />'),b.push("</div>"),App.CusThemeLib.bodyBgi.lib.each(function(a){b.push('<div class="bodyBgiSmp">'),b.push('<img src="'+(a.smp||a.src)+'" alt="'+a.src+'" value="'+a.src+'" />'),b.push("</div>")}.bind(this)),b.push("</div>"),b.push('<iframe src="/htmlarea/popups/insert_cusTheme.html?mode=bodybgi&d='+_blog_domain+'" frameborder="0" style="margin-left:5px;display:none"></iframe>'),b.push('<input name="ct_body_bgi_bak" type="hidden" />'),b.push("</fieldset>"),b.push("<fieldset>"),b.push("<legend>"+App.Lang.imageOption+"</legend>"),b.push('<table width="100%" style="border-top:1px solid #eee;">'),b.push("<tr>"),b.push('<td width="35">'+App.Lang.tiled+":</td>"),b.push("<td>"),b.push('<select name="ct_body_bgr" class="text">'),b.push('<option value="">'+App.Lang.def+"</option>"),b.push('<option value="repeat">'+App.Lang.repeat+"</option>"),b.push('<option value="no-repeat">'+App.Lang.noRepeat+"</option>"),b.push('<option value="repeat-x">'+App.Lang.repeatX+"</option>"),b.push('<option value="repeat-y">'+App.Lang.repeatY+"</option>"),b.push("</select>"),b.push("</td>"),b.push("</tr>"),b.push("<tr>"),b.push("<td>"+App.Lang.align+":</td>"),b.push("<td>"+App.Lang.horizontal+' <select name="ct_body_bgp_x" class="text">'),b.push('<option value="">'+App.Lang.def+"</option>"),b.push('<option value="left">'+App.Lang.left+"</option>"),b.push('<option value="center">'+App.Lang.center+"</option>"),b.push('<option value="right">'+App.Lang.right+"</option>"),b.push("</select>"),b.push("&nbsp;&nbsp;&nbsp;&nbsp;"+App.Lang.vertical+' <select name="ct_body_bgp_y" class="text">'),b.push('<option value="">'+App.Lang.def+"</option>"),b.push('<option value="top">'+App.Lang.top+"</option>"),b.push('<option value="center">'+App.Lang.middle+"</option>"),b.push('<option value="bottom">'+App.Lang.bottom+"</option>"),b.push("</select></td>"),b.push("</tr>"),b.push("</table>"),b.push("</fieldset>"),a.innerHTML=b.join("");var c=$A(a.getElementsByTagName("input"));return c=c.concat($A(a.getElementsByTagName("select"))),$A(c).each(function(a){a.name=="ct_body_bgi_bak"&&(this.ipt_body_bgi_bak=a),a.name=="ct_body_bgr"&&(this.ipt_body_bgr=a),a.name=="ct_body_bgp_x"&&(this.ipt_body_bgp_x=a),a.name=="ct_body_bgp_y"&&(this.ipt_body_bgp_y=a),a.name=="ct_body_h"&&(this.ipt_body_h=a)}.bind(this)),this.ifm_body_bgi_up=a.getElementsByTagName("iframe")[0],this.elm_body_bgis=document.getElementsByClassName("bodyBgiSmp",a,"div"),setTimeout(function(){this.updateCusBodyData(),this.observeCusBody()}.bind(this),1),a},updateCusBodyData:function(){this.getStyle("body_bgi")&&this.getStyle("body_bgi")=="transparent"?this.activeOneBodyBgi("none"):this.getStyle("body_bgi")!=""?App.CusThemeLib.bodyBgi.getImg(this.getStyle("body_bgi"))?this.activeOneBodyBgi(this.getStyle("body_bgi")):this.activeOneBodyBgi("upload"):this.activeOneBodyBgi("default"),this.ipt_body_bgi_bak.value=this.getStyle("body_bak_bgi"),this.ipt_body_bgr.value=this.getStyle("body_bgr"),this.ipt_body_bgp_x.value=this.getStyle("body_bgp_x"),this.ipt_body_bgp_y.value=this.getStyle("body_bgp_y")},activeOneBodyBgi:function(a){$A(this.elm_body_bgis).each(function(b){b.firstChild.getAttribute("value")==a?(Element.addClassName(b,"bodyBgiSmp-active"),b.style.display=="none"&&Element.show(b)):Element.removeClassName(b,"bodyBgiSmp-active")})},observeCusBody:function(){$A(this.elm_body_bgis).each(function(a){Event.observe(a,"mouseover",function(){Element.addClassName(a,"bodyBgiSmp-over")}.bind(this)),Event.observe(a,"mouseout",function(){Element.removeClassName(a,"bodyBgiSmp-over")}.bind(this)),Event.observe(a,"click",function(){var b=a.firstChild.getAttribute("value");this.activeOneBodyBgi(b),Element.hide(this.ifm_body_bgi_up),b=="default"?(this.setCss("body","background-image",""),this.ipt_body_bgr.value&&(this.ipt_body_bgr.value="",this.setCss("body","background-repeat",""))):b=="none"?this.setCss("body","background-image","none"):b=="upload"?(Element.show(this.ifm_body_bgi_up),$F(this.ipt_body_bgi_bak)&&this.setCss("body","background-image","url("+$F(this.ipt_body_bgi_bak)+")")):(this.setCss("body","background-image","url("+b+")"),(_tiled=App.CusThemeLib.bodyBgi.getImg(b).tiled)&&this.ipt_body_bgr.value!=_tiled&&(this.ipt_body_bgr.value=_tiled,this.setCss("body","background-repeat",_tiled)))}.bind(this))}.bind(this)),Event.observe(this.ipt_body_bgr,"change",function(){this.setCss("body","background-repeat",this.ipt_body_bgr.value)}.bind(this)),Event.observe(this.ipt_body_bgp_x,"change",function(){var a="";if(this.ipt_body_bgp_x.value||this.ipt_body_bgp_y.value)a=(this.ipt_body_bgp_x.value||"left")+" "+(this.ipt_body_bgp_y.value||"top");this.setCss("body","background-position",a)}.bind(this)),Event.observe(this.ipt_body_bgp_y,"change",function(){var a="";if(this.ipt_body_bgp_x.value||this.ipt_body_bgp_y.value)a=(this.ipt_body_bgp_x.value||"left")+" "+(this.ipt_body_bgp_y.value||"top");this.setCss("body","background-position",a)}.bind(this))},analyesTagCss:function(a){var b=null,c=$(a);if(c){b={};var d=c.sheet||c.styleSheet,e=d.cssRules||d.rules;$A(e).each(function(a){var c=a.selectorText.toLowerCase().split(",");$A(c).each(function(c){var d=c.replace(/(^\s*)|(\s*$)/g,"");b[d]||(b[d]={});var e=a.style;$H(e).each(function(a){a.value&&a.key!="cssText"&&typeof a.value=="string"&&a.key.indexOf("Moz")!=0&&isNaN(a.key-0)&&(b[d][a.key]=a.value)})})})}return b},getRuntimeCss:function(){var a=this.analyesTagCss("openTheme"),b=this.analyesTagCss("customTheme");return a&&b?Object.extend(a,b):a||b},analyesCss:function(){this.styles=this.getRuntimeCss()},getCss:function(a,b){this.styles||this.analyesCss();var c=b.camelize();return this.styles&&this.styles[a]?this.styles[a][c]?this.styles[a][c]:"":""},setCss:function(a,b,c){var d=$("customTheme");d||(d=document.createElement("style"),d.id="customTheme",d.type="text/css",document.getElementsByTagName("head")[0].appendChild(d));var e=d.sheet||d.styleSheet,f=e.cssRules||e.rules,g=f.length;$A(f).each(function(c,d){if(c.selectorText.toLowerCase()==a&&c.style[b.camelize()])throw g=d,e.deleteRule?e.deleteRule(d):e.removeRule(d),$break}.bind(this));if(c){var h=a+"{"+b+":"+c+";}";e.insertRule?e.insertRule(h,g):e.addRule(a,b+":"+c+";")}},getStyle:function(a){switch(a){case"header_bgi":return this.getCss("#header","background-image").replace(/url\((.*)\)/,"$1");case"header_bak_bgi":return this.getCss("#header-bak","background-image").replace(/url\((.*)\)/,"$1");case"header_bgr":return this.getCss("#header","background-repeat");case"header_bgp_x":return this.getCss("#header","background-position")?this.getCss("#header","background-position").split(" ")[0]:"";case"header_bgp_y":return this.getCss("#header","background-position")?this.getCss("#header","background-position").split(" ")[1]:"";case"header_h":return parseInt(this.getCss("#header","height"))||"";case"body_bgi":return this.getCss("body","background-image").replace(/url\((.*)\)/,"$1");case"body_bak_bgi":return this.getCss("body-bak","background-image").replace(/url\((.*)\)/,"$1");case"body_bgr":return this.getCss("body","background-repeat");case"body_bgp_x":return this.getCss("body","background-position")?this.getCss("body","background-position").split(" ")[0]:"";case"body_bgp_y":return this.getCss("body","background-position")?this.getCss("body","background-position").split(" ")[1]:"";default:return null}},getCustomStyles:function(){this.analyesCss();var a="";return a+="#header{background-image: "+this.getCss("#header","background-image")+";}",a+="#header{background-repeat: "+this.getCss("#header","background-repeat")+";}",a+="#header{background-position: "+this.getCss("#header","background-position")+";}",a+="#header{height: "+this.getCss("#header","height")+";}",a+="body{background-image: "+this.getCss("body","background-image")+";}",a+="body{background-repeat: "+this.getCss("body","background-repeat")+";}",a+="body{background-position: "+this.getCss("body","background-position")+";}",a},getCustomSets:function(a){this.analyesCss();var b="";return b+="css|#header|bgi="+this.getCss("#header","background-image"),a||(b+="&css|#header-bak|bgi="+this.getCss("#header-bak","background-image")),b+="&css|#header|bgr="+this.getCss("#header","background-repeat"),b+="&css|#header|bgp="+this.getCss("#header","background-position"),b+="&css|#header|h="+this.getCss("#header","height"),b+="&css|body|bgi="+this.getCss("body","background-image"),a||(b+="&css|body-bak|bgi="+this.getCss("body-bak","background-image")),b+="&css|body|bgr="+this.getCss("body","background-repeat"),b+="&css|body|bgp="+this.getCss("body","background-position"),b},save:function(){var a=this.getCustomSets();App.Requester.request("customTheme",a);var b={type:"confirm",content:"自定义主题已生效。<br/><br/>提示：如果您再完善一些详细信息，就可以分享给其他博友使用。",okText:"分享",cancelText:"不分享",focus:!1,okAction:this.shareTheme.bind(this)},c=new PopWin(b)},saveOk:function(){var a=this.getCustomStyles();$("openTheme")&&Element.remove("openTheme"),$("customTheme").innerHTML=a},styleAllOk:function(){location.href=ToolBar.getBlogPath()},shareTheme:function(){switch(this.getThemeType()){case 3:var a=document.createElement("div");a.innerHTML='<form method="post" action="http://ow.blog.sohu.com/manage/theme.do?action=submittheme" target="_blank"><input type="hidden" name="theme" value="" /><input type="hidden" name="style" value="" /></form>',a=document.body.appendChild(a);var b=a.childNodes[0];b.theme.value=$("themeCss").getAttribute("themeid"),b.childNodes[1].value=this.getCustomSets(),b.submit();break;case 2:alert(App.Lang.noSharePay);break;default:alert(App.Lang.needCustom)}},getThemeId:function(){var a=$("themeCss"),b;return(b=a.getAttribute("themeid"))&&typeof b=="string"&&b.length>0?b:null},getThemeType:function(){var a=$("customTheme"),b=$("openTheme"),c=null;if(this.getCss("#header","background-image")!=""||this.getCss("body","background-image")!=""){if(a)return 3;if(b)return 4}return(c=this.getThemeId())&&c.indexOf("g")==0?2:1},clean:function(){App.Requester.request("customThemeClean",this)},cleanOk:function(){var a=$("customTheme");a&&Element.remove(a),this.styles=null,setTimeout(function(){try{this.updateCusHeaderData()}catch(a){}try{this.updateCusBodyData()}catch(a){}}.bind(this),10),this.cusThemeWin.hide()},cancel:function(){$H(this.stylesTempl).each(function(a){$H(a.value).each(function(b){this.setCss(a.key,b.key.underscore().dasherize(),this.styles&&this.styles[a.key]&&this.styles[a.key][b.key]?this.styles[a.key][b.key]:"")}.bind(this))}.bind(this)),setTimeout(function(){try{this.updateCusHeaderData()}catch(a){}try{this.updateCusBodyData()}catch(a){}}.bind(this),10)},upHeadbgiOk:function(a){a&&(this.ipt_header_bgi_bak.value=a,this.setCss("#header-bak","background-image","url("+a+")"),this.setCss("#header","background-image","url("+a+")"))},upBodybgiOk:function(a){a&&(this.ipt_body_bgi_bak.value=a,this.setCss("body-bak","background-image","url("+a+")"),this.setCss("body","background-image","url("+a+")"))}};var Feed=function(a){this.root=a.responseXML.documentElement,this.type=this.root.nodeName=="feed"?1:0;var b=this.type==1?this.root:this.root.getElementsByTagName("channel")[0],c=Element.getChildElementByTagName(b,"link");this.type==1?$A(c).each(function(a){if(a.getAttribute("type")=="text/html"||c.length==1)this.htmlUrl=a.getAttribute("href")}.bind(this)):this.htmlUrl=c[0].firstChild?c[0].firstChild.nodeValue:"",this.title=Element.getChildValueByTagName(b,"title")[0]||this.htmlUrl;var d=this.type==1?this.root.getElementsByTagName("tagline"):this.root.getElementsByTagName("description");this.description=d.length>0?d[0].firstChild?d[0].firstChild.nodeValue:"":"",this.items=[];var e=this.type==1?this.root.getElementsByTagName("entry"):this.root.getElementsByTagName("item");$A(e).each(function(a){var b={};b.node=a,b.enclosures=a.getElementsByTagName("enclosure");var c=Element.getChildElementByTagName(a,"title")[0];if(c&&c.firstChild)b.title=c.firstChild.nodeValue;else{var d=a.getElementsByTagName("description");if(d[0]){var e=document.createElement("div");e.innerHTML=d[0].firstChild.nodeValue,b.title=(e.innerText?e.innerText.substring(0,50):"")+"..."}else b.title="[...]"}var f=Browser.ua.indexOf("ie")>=0?a.getElementsByTagName("dc:date")[0]:a.getElementsByTagName("date")[0];a.getElementsByTagName("pubDate")[0]?b.date=a.getElementsByTagName("pubDate")[0].firstChild?a.getElementsByTagName("pubDate")[0].firstChild.nodeValue:"":f?b.date=f.firstChild.nodeValue:a.getElementsByTagName("issued")[0]&&(b.date=a.getElementsByTagName("issued")[0].firstChild.nodeValue);var g=Element.getChildElementByTagName(a,"link");g.length>0?this.type==1?$A(g).each(function(a){if(a.getAttribute("type")=="text/html"||g.length==1)b.link=a.getAttribute("href")}):g[0]||g[0].firstChild?b.link=g[0].firstChild?g[0].firstChild.nodeValue:"":a.getElementsByTagName("guid")[0].firstChild&&(b.link=a.getElementsByTagName("guid")[0].firstChild.nodeValue):b.link=this.htmlUrl,this.type==1?(b.content=a.getElementsByTagName("content")[0],b.description=a.getElementsByTagName("summary")[0]):(b.content=Browser.ua.indexOf("ie")>=0?a.getElementsByTagName("content:encoded")[0]:a.getElementsByTagName("encoded")[0],b.description=a.getElementsByTagName("description")[0]),this.items.push(b)}.bind(this))},PopWins={popWins:[],x:null,y:null,zIndex:2e3,register:function(a){this.popWins.push(a),!(Browser.ua.indexOf("ie")<0)},unregister:function(a){this.popWins=this.popWins.reject(function(b){return b==a}),this.x-=10,this.y-=10,this.popWins.length<=0&&(this.x=this.y=null,this.zIndex=2e3,Event.stopObserving(window,"resize",this.eventResizeBgAll))},placeIt:function(a){document.body.appendChild(a.element),a.element.style.position="absolute",a.element.style.zIndex=this.zIndex++,a.element.style.width=a.options.width+"px",a.element.offsetHeight>=500&&(a.elm_content.style.height="500px"),!this.x||!this.y?(this.x=(document.body.offsetWidth-a.element.offsetWidth)/2,this.y=Math.ceil((document.documentElement.clientHeight-a.element.offsetHeight)/2)*.6+document.documentElement.scrollTop):(this.x+=10,this.y+=10),a.element.style.left=this.x+"px",a.element.style.top=this.y+"px",a.dragObj=new Draggable(a.element,{handle:"t",zindex:this.zIndex}),this.eventCancelBubble=App.cancelBubble.bindAsEventListener(this),Event.observe(a.element,"mousedown",this.eventCancelBubble),Event.observe(a.element,"click",this.eventCancelBubble)},placeBg:function(a){document.body.appendChild(a.elm_bg);var b={background:"#666",position:"absolute",zIndex:this.zIndex++,left:"0px",top:"0px",width:document.body.offsetWidth+"px",height:Math.max(document.body.offsetHeight,document.documentElement.clientHeight)+"px"};Element.setStyle(a.elm_bg,b),this.eventResizeBgAll=this.resizeBgAll.bindAsEventListener(this),Event.observe(window,"resize",this.eventResizeBgAll),this.eventCancelBubble=App.cancelBubble.bindAsEventListener(this),Event.observe(a.elm_bg,"mousedown",this.eventCancelBubble),Event.observe(a.elm_bg,"click",this.eventCancelBubble);if(Browser.ua.indexOf("ie")>=0)Element.setOpacity(a.elm_bg,.5);else{Element.setOpacity(a.elm_bg,0);var c=new Effect.Opacity(a.elm_bg,{duration:.3,from:0,to:.5})}},resizeBgAll:function(){this.popWins.each(function(a){this.resizeBg(a)}.bind(this))},resizeBg:function(a){var b={width:document.body.offsetWidth+"px",height:Math.max(document.body.offsetHeight,document.documentElement.clientHeight)+"px"};Element.setStyle(a.elm_bg,b)}},PopWin=Class.create();PopWin.prototype={initialize:function(a){this.options=Object.extend({name:"popWin",type:"pop",focus:!0,title:"",ico:"info",content:"",html:!0,width:"250",okText:App.Lang.ok,okAction:null,okData:null,cancelText:App.Lang.cancel,cancelAction:null,cancelData:null,closeAction:null,closeData:null},a||{}),this.options.ico="ico_"+this.options.ico+".gif",this.options.type!="pop"&&(this.buildBg(),PopWins.placeBg(this)),this.build(),this.options.content&&(this.options.html?this.elm_content.innerHTML=this.options.content.replace(/\n/ig,"<br />"):this.elm_content.innerHTML=this.options.content.convertTextToHTML().replace(/\n/ig,"<br />")),PopWins.placeIt(this);if(this.options.type=="alert"||this.options.type=="confirm")this.buildBtn(),setTimeout(this.getFocus.bind(this),10),this.eventGetFocus=this.getFocus.bindAsEventListener(this),Event.observe(this.elm_bg,"click",this.eventGetFocus),Event.observe(this.element,"click",this.eventGetFocus);PopWins.register(this)},destroy:function(){Element.remove(this.element),this.elm_bg&&(Element.setOpacity(this.elm_bg,1),Element.remove(this.elm_bg)),PopWins.unregister(this)},build:function(){var a=document.createElement("div");this.element=a,a.id=this.options.name,a.className="popWin";var b=document.createElement("div");b.className="mod",a.appendChild(b);var c=document.createElement("div");this.elm_popWinFrame=c,c.className="modFrame",b.appendChild(c);var d="";d+='<table cellspacing="0" cellpadding="0" class="modTable" height="100%">',d+="<thead><tr>",d+='<td class="mheader lt"></td>',d+='<td class="mheader t"><div class="modHeader"></div></td>',d+='<td class="mheader rt"></td>',d+="</tr></thead>",d+="<tbody><tr>",d+='<td class="mbody l"></td>',d+='<td class="mbody c" height="100%"><div class="modCon"></div></td>',d+='<td class="mbody r"></td>',d+="</tr></tbody>",d+="<tfoot><tr>",d+='<td class="mfooter lb"></td>',d+='<td class="mfooter b"></td>',d+='<td class="mfooter rb"></td>',d+="</tr></tfoot>",d+="</table>",c.innerHTML=d,this.eventCancelBubble=App.cancelBubble.bindAsEventListener(this);var e=document.createElement("div");this.elm_close=e,e.className="modCls",e.title=App.Lang.close,Event.observe(e,"mousedown",this.eventCancelBubble),this.eventClose=this.closeAction.bindAsEventListener(this),Event.observe(e,"click",this.eventClose);var f=document.createElement("div");this.elm_ico=f,f.className="modIco",f.innerHTML='<img src="'+App.Actions.imgPath+this.options.ico+'" />';var g=document.createElement("div");this.elm_title=g,g.className="modTitle",g.appendChild(document.createTextNode(this.options.title||App.Lang.info));var h=document.getElementsByClassName("modHeader",c)[0];h.appendChild(e),h.appendChild(f),h.appendChild(g),Element.cleanWhitespace(this.element),this.elm_content=this.getPopWinContent()},getPopWinContent:function(){var a=this.element.firstChild.firstChild.firstChild,b=a.rows[1].cells[1].firstChild;return b},close:function(){this.destroy()},buildBg:function(){var a=document.createElement("div");this.elm_bg=a},buildBtn:function(){var a=document.createElement("div");a.className="divBtn";var b=document.createElement("input");this.okBtn=b,b.className="button-submit",b.type="button",b.value=this.options.okText,this.eventOkAction=this.okAction.bindAsEventListener(this),Event.observe(b,"click",this.eventOkAction),a.appendChild(b);if(this.options.type=="confirm"){var c=document.createElement("input");this.cancelBtn=c,c.className="button",c.type="button",c.value=this.options.cancelText,this.eventCancelAction=this.cancelAction.bindAsEventListener(this),Event.observe(c,"click",this.eventCancelAction),a.appendChild(c)}this.elm_content.parentNode.appendChild(a)},okAction:function(){this.close(),this.options.okAction&&(this.options.okData?this.options.okAction(this.options.okData):this.options.okAction(!0))},cancelAction:function(){this.close(),this.options.cancelAction&&(this.options.cancelData?this.options.cancelAction(this.options.cancelData):this.options.cancelAction(!1))},closeAction:function(){this.options.closeAction?(this.close(),this.options.closeData?this.options.closeAction(this.options.closeData):this.options.closeAction(!0)):this.options.type=="confirm"?this.cancelAction():this.options.type=="alert"?this.okAction():this.close()},getFocus:function(){if(this.options.type!="alert"&&this.options.type!="confirm")return;this.options.focus===!1?this.cancelBtn.focus():this.okBtn.focus()}},App.ToolTip=function(a,b,c,d,e){function k(){return document.compatMode&&document.compatMode!="BackCompat"?document.documentElement:document.body}function l(a){if(h){var b=Browser.ua.indexOf("ie")>=0?Event.pointerX(a):Event.pointerX(a),c=Browser.ua.indexOf("ie")>=0?Event.pointerY(a):Event.pointerY(a),d=Browser.ua.indexOf("ie")>=0&&Browser.ua!="opera"?k().clientWidth-Event.pointerX(a)+k().scrollLeft-f:window.innerWidth-Event.pointerX(a)+window.pageXOffset-f-20,e=Browser.ua.indexOf("ie")>=0&&Browser.ua!="opera"?k().clientHeight-Event.pointerY(a)+k().scrollTop-g:window.innerHeight-Event.pointerY(a)+window.pageYOffset-g-20,i=f<0?f*-1:-1e3;d<j.offsetWidth?j.style.left=Browser.ua.indexOf("ie")>=0?Event.pointerX(a)-j.offsetWidth+"px":Event.pointerX(a)-j.offsetWidth+"px":b<i?j.style.left="5px":j.style.left=b+f+"px";if(e<j.offsetHeight){var l=Browser.ua=="safari"?0:window.pageYOffset;j.style.top=Browser.ua.indexOf("ie")>=0?Event.pointerY(a)-j.offsetHeight-g+"px":Event.pointerY(a)-j.offsetHeight-g+"px"}else j.style.top=c+g+"px"}}var f=0,g=20,h=!1,i,j;$("tooltip")?j=$("tooltip"):(j=document.createElement("div"),j.id="tooltip",j.className="mod",j.style.position="absolute",document.body.appendChild(j)),c||(c=200),d||(d="center"),this.display=function(a,b,c,d){l(window.event),Event.observe(document,"mousemove",l),Event.observe(a,"mouseout",this.hide,!1),j.style.textAlign=d,j.innerHTML='<div class="modFrame">'+b+"</div>",Element.show(j),j.offsetWidth>c&&(j.style.width=c+"px"),h=!0,i=setTimeout(this.hide,1e4)},this.hide=function(){clearTimeout(i),Event.stopObserving(document,"ousemove",l),h=!1,Element.hide(j)},this.display(a,b,c,d)}